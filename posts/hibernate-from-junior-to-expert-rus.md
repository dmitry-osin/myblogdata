- [–£—Ä–æ–≤–µ–Ω—å 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç –∏ –§–∏–ª–æ—Å–æ—Ñ–∏—è (Junior)](#—É—Ä–æ–≤–µ–Ω—å-1-—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç-–∏-—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è-junior)
  - [1. –û—Å–Ω–æ–≤—ã JDBC –∏ SQL (–ó–∞—á–µ–º –Ω–∞–º –≤–æ–æ–±—â–µ ORM?)](#1-–æ—Å–Ω–æ–≤—ã-jdbc-–∏-sql-–∑–∞—á–µ–º-–Ω–∞–º-–≤–æ–æ–±—â–µ-orm)
    - [–ü—Ä–æ–±–ª–µ–º–∞ JDBC](#–ø—Ä–æ–±–ª–µ–º–∞-jdbc)
    - [–†–µ—à–µ–Ω–∏–µ ORM](#—Ä–µ—à–µ–Ω–∏–µ-orm)
  - [2. –í–≤–µ–¥–µ–Ω–∏–µ –≤ JPA –∏ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#2-–≤–≤–µ–¥–µ–Ω–∏–µ-–≤-jpa-–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
    - [JPA vs Hibernate](#jpa-vs-hibernate)
    - [–ë–∞–∑–æ–≤—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏](#–±–∞–∑–æ–≤—ã–µ-–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏)
    - [–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ID (`@GeneratedValue`)](#—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏-id-generatedvalue)
  - [3. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª Entity –∏ Persistence Context](#3-–∂–∏–∑–Ω–µ–Ω–Ω—ã–π-—Ü–∏–∫–ª-entity-–∏-persistence-context)
    - [4 —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–∏ (Entity States)](#4-—Å–æ—Å—Ç–æ—è–Ω–∏—è-—Å—É—â–Ω–æ—Å—Ç–∏-entity-states)
    - [Dirty Checking (–ì—Ä—è–∑–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)](#dirty-checking-–≥—Ä—è–∑–Ω–∞—è-–ø—Ä–æ–≤–µ—Ä–∫–∞)
    - [–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã EntityManager](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–º–µ—Ç–æ–¥—ã-entitymanager)
- [–£—Ä–æ–≤–µ–Ω—å 2: –û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –ë–∞–∑–æ–≤—ã–π Spring Data (Middle)](#—É—Ä–æ–≤–µ–Ω—å-2-–æ—Ç–Ω–æ—à–µ–Ω–∏—è-–∏-–±–∞–∑–æ–≤—ã–π-spring-data-middle)
  - [4. –ú–∞–ø–ø–∏–Ω–≥ –æ—Ç–Ω–æ—à–µ–Ω–∏–π (Associations)](#4-–º–∞–ø–ø–∏–Ω–≥-–æ—Ç–Ω–æ—à–µ–Ω–∏–π-associations)
    - [–í–ª–∞–¥–µ—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (Owning Side) vs –û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (Inverse Side)](#–≤–ª–∞–¥–µ—é—â–∞—è-—Å—Ç–æ—Ä–æ–Ω–∞-owning-side-vs-–æ–±—Ä–∞—Ç–Ω–∞—è-—Å—Ç–æ—Ä–æ–Ω–∞-inverse-side)
    - [–ü—Ä–∏–º–µ—Ä: One-To-Many (–û–¥–∏–Ω –∫–æ –ú–Ω–æ–≥–∏–º)](#–ø—Ä–∏–º–µ—Ä-one-to-many-–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º)
    - [–ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (Cascade) –∏ Orphan Removal](#–∫–∞—Å–∫–∞–¥–Ω—ã–µ-–æ–ø–µ—Ä–∞—Ü–∏–∏-cascade-–∏-orphan-removal)
  - [5. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å–æ Spring Data JPA](#5-–∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ-—Å–æ-spring-data-jpa)
    - [–ò–µ—Ä–∞—Ä—Ö–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤](#–∏–µ—Ä–∞—Ä—Ö–∏—è-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
    - [–ú–∞–≥–∏—è Derived Queries (–ó–∞–ø—Ä–æ—Å—ã –∏–∑ –∏–º–µ–Ω–∏ –º–µ—Ç–æ–¥–∞)](#–º–∞–≥–∏—è-derived-queries-–∑–∞–ø—Ä–æ—Å—ã-–∏–∑-–∏–º–µ–Ω–∏-–º–µ—Ç–æ–¥–∞)
    - [@Query (–ö–æ–≥–¥–∞ –∏–º—è –º–µ—Ç–æ–¥–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ)](#query-–∫–æ–≥–¥–∞-–∏–º—è-–º–µ—Ç–æ–¥–∞-—Å–ª–∏—à–∫–æ–º-–¥–ª–∏–Ω–Ω–æ–µ)
    - [–ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞](#–ø–∞–≥–∏–Ω–∞—Ü–∏—è-–∏-—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞)
- [–£—Ä–æ–≤–µ–Ω—å 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –¢–∏–ø—ã (Senior)](#—É—Ä–æ–≤–µ–Ω—å-3-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏-–∏-—Ç–∏–ø—ã-senior)
  - [6. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –º–∞–ø–ø–∏–Ω–≥](#6-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π-–º–∞–ø–ø–∏–Ω–≥)
    - [–í—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã (Value Objects)](#–≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ-–æ–±—ä–µ–∫—Ç—ã-value-objects)
    - [–ú–∞–ø–ø–∏–Ω–≥ Enums](#–º–∞–ø–ø–∏–Ω–≥-enums)
    - [–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (Inheritance)](#–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ-inheritance)
  - [7. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤](#7-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ-–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ-–∑–∞–ø—Ä–æ—Å–æ–≤)
    - [Criteria API](#criteria-api)
    - [Spring Data Specifications](#spring-data-specifications)
    - [Projections (–ü—Ä–æ–µ–∫—Ü–∏–∏)](#projections-–ø—Ä–æ–µ–∫—Ü–∏–∏)
- [–£—Ä–æ–≤–µ–Ω—å 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Expert)](#—É—Ä–æ–≤–µ–Ω—å-4-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å-–∏-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-expert)
  - [8. –ü—Ä–æ–±–ª–µ–º–∞ N+1 –∏ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤—ã–±–æ—Ä–∫–∏ (Fetching)](#8-–ø—Ä–æ–±–ª–µ–º–∞-n1-–∏-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏-–≤—ã–±–æ—Ä–∫–∏-fetching)
    - [–ß—Ç–æ —Ç–∞–∫–æ–µ N+1?](#—á—Ç–æ-—Ç–∞–∫–æ–µ-n1)
    - [–†–µ—à–µ–Ω–∏–µ 1: JOIN FETCH (JPQL)](#—Ä–µ—à–µ–Ω–∏–µ-1-join-fetch-jpql)
    - [–†–µ—à–µ–Ω–∏–µ 2: @EntityGraph (Spring Data)](#—Ä–µ—à–µ–Ω–∏–µ-2-entitygraph-spring-data)
    - [–†–µ—à–µ–Ω–∏–µ 3: Hibernate Batch Fetching](#—Ä–µ—à–µ–Ω–∏–µ-3-hibernate-batch-fetching)
    - [FetchType: EAGER vs LAZY](#fetchtype-eager-vs-lazy)
  - [9. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (L1 –∏ L2)](#9-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ-l1-–∏-l2)
    - [L1 Cache (Session Cache)](#l1-cache-session-cache)
    - [L2 Cache (Shared Cache)](#l2-cache-shared-cache)
  - [10. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏ (Batch Processing)](#10-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–∑–∞–ø–∏—Å–∏-batch-processing)
  - [11. –ü—Ä–æ–∫—Å–∏ –∏ LazyInitializationException](#11-–ø—Ä–æ–∫—Å–∏-–∏-lazyinitializationexception)
    - [–ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç?](#–ø–æ—á–µ–º—É-–≤–æ–∑–Ω–∏–∫–∞–µ—Ç)
    - [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Proxy?](#–∫–∞–∫-—Ä–∞–±–æ—Ç–∞–µ—Ç-proxy)
    - [–ö–∞–∫ –ª–µ—á–∏—Ç—å LazyInit?](#–∫–∞–∫-–ª–µ—á–∏—Ç—å-lazyinit)
- [–£—Ä–æ–≤–µ–Ω—å 5: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å, –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Architect)](#—É—Ä–æ–≤–µ–Ω—å-5-–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏-–∏-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-architect)
  - [12. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏](#12-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏)
    - [–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è @Transactional](#–∞–Ω–Ω–æ—Ç–∞—Ü–∏—è-transactional)
    - [Propagation (–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ)](#propagation-—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ)
    - [–£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ (Isolation Levels)](#—É—Ä–æ–≤–Ω–∏-–∏–∑–æ–ª—è—Ü–∏–∏-isolation-levels)
  - [13. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (Locking)](#13-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏-locking)
    - [Optimistic Locking (–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)](#optimistic-locking-–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
    - [Pessimistic Locking (–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)](#pessimistic-locking-–ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω–∞—è-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
  - [14. –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (Schema Management)](#14-–º–∏–≥—Ä–∞—Ü–∏–∏-–±–∞–∑-–¥–∞–Ω–Ω—ã—Ö-schema-management)
    - [–ü—Ä–æ–±–ª–µ–º–∞ `ddl-auto`](#–ø—Ä–æ–±–ª–µ–º–∞-ddl-auto)
    - [–†–µ—à–µ–Ω–∏–µ: Flyway –∏–ª–∏ Liquibase](#—Ä–µ—à–µ–Ω–∏–µ-flyway-–∏–ª–∏-liquibase)
  - [15. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#15-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
    - [@DataJpaTest](#datajpatest)
    - [H2 vs Testcontainers](#h2-vs-testcontainers)
- [–£—Ä–æ–≤–µ–Ω—å 6. –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞–Ω–Ω—ã—Ö: –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –∏ Soft Delete](#—É—Ä–æ–≤–µ–Ω—å-6-—Ç–æ–Ω–∫–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–¥–∞–Ω–Ω—ã—Ö-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã-–∏-soft-delete)
  - [16. Attribute Converters (`@Converter`)](#16-attribute-converters-converter)
    - [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](#–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
    - [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ-–¥–∞–Ω–Ω—ã—Ö)
    - [ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏](#-–ø–æ–¥–≤–æ–¥–Ω—ã–µ-–∫–∞–º–Ω–∏)
  - [17. Soft Delete (–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)](#17-soft-delete-–º—è–≥–∫–æ–µ-—É–¥–∞–ª–µ–Ω–∏–µ)
    - [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ Hibernate 6.3+)](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π-–ø–æ–¥—Ö–æ–¥-hibernate-63)
    - [–ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ –∫–æ–¥–µ](#–∫–∞–∫-—ç—Ç–æ-–≤—ã–≥–ª—è–¥–∏—Ç-–≤-–∫–æ–¥–µ)
    - [ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ (Expert Level)](#-–ø–æ–¥–≤–æ–¥–Ω—ã–µ-–∫–∞–º–Ω–∏-expert-level)
  - [18. Entity Listeners (–û–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã)](#18-entity-listeners-–æ–±—Ä–∞—Ç–Ω—ã–µ-–≤—ã–∑–æ–≤—ã)
    - [ü™® –í–∞–∂–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ](#-–≤–∞–∂–Ω–æ–µ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ)
- [–£—Ä–æ–≤–µ–Ω—å 7. –°–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–î: Multi-tenancy –∏ –†–µ–ø–ª–∏–∫–∞—Ü–∏—è](#—É—Ä–æ–≤–µ–Ω—å-7-—Å–ª–æ–∂–Ω–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–±–¥-multi-tenancy-–∏-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
  - [19. Multi-tenancy (–ú—É–ª—å—Ç–∏-–∞—Ä–µ–Ω–¥–Ω–æ—Å—Ç—å)](#19-multi-tenancy-–º—É–ª—å—Ç–∏-–∞—Ä–µ–Ω–¥–Ω–æ—Å—Ç—å)
    - [–¢—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#—Ç—Ä–∏-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
    - [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ Hibernate (Separate Schema)](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-–≤-hibernate-separate-schema)
      - [–®–∞–≥ 1. –ö—Ç–æ —Å—Ç—É—á–∏—Ç—Å—è? (`CurrentTenantIdentifierResolver`)](#—à–∞–≥-1-–∫—Ç–æ-—Å—Ç—É—á–∏—Ç—Å—è-currenttenantidentifierresolver)
      - [–®–∞–≥ 2. –î–∞–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (`MultiTenantConnectionProvider`)](#—à–∞–≥-2-–¥–∞–π-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-multitenantconnectionprovider)
      - [ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ (Expert)](#-–ø–æ–¥–≤–æ–¥–Ω—ã–µ-–∫–∞–º–Ω–∏-expert)
  - [20. Read/Write Splitting (–†–µ–ø–ª–∏–∫–∞—Ü–∏—è)](#20-readwrite-splitting-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
    - [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è: `AbstractRoutingDataSource`](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-abstractroutingdatasource)
    - [ü™® –ì–ª–∞–≤–Ω—ã–π –ø–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å: Replication Lag](#-–≥–ª–∞–≤–Ω—ã–π-–ø–æ–¥–≤–æ–¥–Ω—ã–π-–∫–∞–º–µ–Ω—å-replication-lag)
- [–£—Ä–æ–≤–µ–Ω—å 8. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞](#—É—Ä–æ–≤–µ–Ω—å-8-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ-–∑–∞–ø—Ä–æ—Å—ã-–∏-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
  - [21. –ü—Ä–æ–±–ª–µ–º–∞ —á–∏—Å—Ç–æ–≥–æ JPA –∏ Native Queries](#21-–ø—Ä–æ–±–ª–µ–º–∞-—á–∏—Å—Ç–æ–≥–æ-jpa-–∏-native-queries)
    - [–†–µ—à–µ–Ω–∏–µ 1: Native Query (–õ–æ–±–æ–≤–∞—è –∞—Ç–∞–∫–∞)](#—Ä–µ—à–µ–Ω–∏–µ-1-native-query-–ª–æ–±–æ–≤–∞—è-–∞—Ç–∞–∫–∞)
    - [ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏](#-–ø–æ–¥–≤–æ–¥–Ω—ã–µ-–∫–∞–º–Ω–∏-1)
  - [22. Blaze-Persistence (–°–µ–∫—Ä–µ—Ç–Ω–æ–µ –æ—Ä—É–∂–∏–µ)](#22-blaze-persistence-—Å–µ–∫—Ä–µ—Ç–Ω–æ–µ-–æ—Ä—É–∂–∏–µ)
    - [–ü—Ä–∏–º–µ—Ä: CTE (–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π)](#–ø—Ä–∏–º–µ—Ä-cte-–∏–µ—Ä–∞—Ä—Ö–∏—è-–∫–∞—Ç–µ–≥–æ—Ä–∏–π)
  - [23. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ü—Ä–æ–µ–∫—Ü–∏–∏ (Projections)](#23-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ-–ø—Ä–æ–µ–∫—Ü–∏–∏-projections)
    - [–£—Ä–æ–≤–µ–Ω—å 1: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (–ë—ã–ª–æ –≤—ã—à–µ)](#—É—Ä–æ–≤–µ–Ω—å-1-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã-–±—ã–ª–æ-–≤—ã—à–µ)
    - [–£—Ä–æ–≤–µ–Ω—å 2: Class-based (DTO) ‚Äî –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π](#—É—Ä–æ–≤–µ–Ω—å-2-class-based-dto--—Å–∞–º—ã–π-–±—ã—Å—Ç—Ä—ã–π)
    - [–£—Ä–æ–≤–µ–Ω—å 3: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ü–∏–∏](#—É—Ä–æ–≤–µ–Ω—å-3-–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–µ–∫—Ü–∏–∏)
    - [ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å (Dynamic Projections)](#-–ø–æ–¥–≤–æ–¥–Ω—ã–π-–∫–∞–º–µ–Ω—å-dynamic-projections)
  - [24. Hibernate 6: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è](#24-hibernate-6-–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è)
- [–£—Ä–æ–≤–µ–Ω—å 9. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å (Hardcore): Propagation, Deadlocks –∏ Pool Starvation](#—É—Ä–æ–≤–µ–Ω—å-9-–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å-hardcore-propagation-deadlocks-–∏-pool-starvation)
  - [25. Propagation (–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)](#25-propagation-—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
    - [–ö–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏](#–∫–ª—é—á–µ–≤—ã–µ-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
    - [‚ò†Ô∏è –ì–ª–∞–≤–Ω–∞—è –ª–æ–≤—É—à–∫–∞: Self-Invocation (–í—ã–∑–æ–≤ —Å–∞–º–æ–≥–æ —Å–µ–±—è)](#Ô∏è-–≥–ª–∞–≤–Ω–∞—è-–ª–æ–≤—É—à–∫–∞-self-invocation-–≤—ã–∑–æ–≤-—Å–∞–º–æ–≥–æ-—Å–µ–±—è)
  - [26. Deadlocks (–í–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –ë–î)](#26-deadlocks-–≤–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏-–≤-–±–¥)
    - [–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ü–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥](#–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π-–ø—Ä–∏–º–µ—Ä-–ø–µ—Ä–µ–≤–æ–¥-–¥–µ–Ω–µ–≥)
    - [–†–µ—à–µ–Ω–∏–µ: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫](#—Ä–µ—à–µ–Ω–∏–µ-–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π-–ø–æ—Ä—è–¥–æ–∫-–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
  - [27. Pool Starvation (–ì–æ–ª–æ–¥–∞–Ω–∏–µ –ø—É–ª–∞)](#27-pool-starvation-–≥–æ–ª–æ–¥–∞–Ω–∏–µ-–ø—É–ª–∞)
- [–§–∏–Ω–∞–ª: –í–∞—à –ø—É—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–∞ (Roadmap –∑–∞–≤–µ—Ä—à–µ–Ω)](#—Ñ–∏–Ω–∞–ª-–≤–∞—à-–ø—É—Ç—å-—ç–∫—Å–ø–µ—Ä—Ç–∞-roadmap-–∑–∞–≤–µ—Ä—à–µ–Ω)
    - [–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ? (–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ)](#—á—Ç–æ-–¥–µ–ª–∞—Ç—å-–¥–∞–ª—å—à–µ-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ-–∑–∞–¥–∞–Ω–∏–µ)
  - [–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (JPA \& Spring Data JPA) –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ-–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ-–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏-jpa--spring-data-jpa-–∏-–∏—Ö-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
    - [1. –û—Å–Ω–æ–≤–Ω—ã–µ (Identity \& Setup)](#1-–æ—Å–Ω–æ–≤–Ω—ã–µ-identity--setup)
      - [`@Entity` (JPA)](#entity-jpa)
      - [`@Table(name = "...")` (JPA)](#tablename---jpa)
      - [`@Id` (JPA)](#id-jpa)
      - [`@GeneratedValue` (JPA)](#generatedvalue-jpa)
    - [2. –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π (Basic Mapping)](#2-–º–∞–ø–ø–∏–Ω–≥-–ø–æ–ª–µ–π-basic-mapping)
      - [`@Column` (JPA)](#column-jpa)
      - [`@Enumerated` (JPA)](#enumerated-jpa)
      - [`@Transient` (JPA)](#transient-jpa)
      - [`@Lob` (JPA)](#lob-jpa)
    - [3. –°–≤—è–∑–∏ (Relationships)](#3-—Å–≤—è–∑–∏-relationships)
      - [`@OneToMany` / `@ManyToOne` (JPA)](#onetomany--manytoone-jpa)
      - [`@JoinColumn` (JPA)](#joincolumn-jpa)
      - [`@ManyToMany` (JPA)](#manytomany-jpa)
    - [4. Hibernate Specific (Power Tools)](#4-hibernate-specific-power-tools)
      - [`@BatchSize(size = 20)` (Hibernate)](#batchsizesize--20-hibernate)
      - [`@Formula("sql query")` (Hibernate)](#formulasql-query-hibernate)
      - [`@DynamicInsert` / `@DynamicUpdate` (Hibernate)](#dynamicinsert--dynamicupdate-hibernate)
      - [`@Immutable` (Hibernate)](#immutable-hibernate)
    - [5. –ê—É–¥–∏—Ç –∏ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ](#5-–∞—É–¥–∏—Ç-–∏-–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
      - [`@Version` (JPA)](#version-jpa)
      - [`@CreationTimestamp` / `@UpdateTimestamp` (Hibernate)](#creationtimestamp--updatetimestamp-hibernate)
    - [6. ‚ò†Ô∏è –û—Å–æ–±–∞—è –∑–æ–Ω–∞: Lombok](#6-Ô∏è-–æ—Å–æ–±–∞—è-–∑–æ–Ω–∞-lombok)
      - [`@Data` (Lombok)](#data-lombok)
  - [–ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Entity](#–∑–æ–ª–æ—Ç–æ–π-—Å—Ç–∞–Ω–¥–∞—Ä—Ç-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏-entity)
    - [1. –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å (Auditing \& MappedSuperclass)](#1-–±–∞–∑–æ–≤—ã–π-–∫–ª–∞—Å—Å-auditing--mappedsuperclass)
    - [2. –ò–¥–µ–∞–ª—å–Ω–∞—è –°—É—â–Ω–æ—Å—Ç—å (User)](#2-–∏–¥–µ–∞–ª—å–Ω–∞—è-—Å—É—â–Ω–æ—Å—Ç—å-user)
    - [3. –í—Ç–æ—Ä–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (Order)](#3-–≤—Ç–æ—Ä–∞—è-—Å—Ç–æ—Ä–æ–Ω–∞-order)
    - [–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫? (–†–∞–∑–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π)](#–ø–æ—á–µ–º—É-–∏–º–µ–Ω–Ω–æ-—Ç–∞–∫-—Ä–∞–∑–±–æ—Ä-–∫–ª—é—á–µ–≤—ã—Ö-—Ä–µ—à–µ–Ω–∏–π)
      - [–ü–æ—á–µ–º—É `hashCode` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É?](#–ø–æ—á–µ–º—É-hashcode-–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç-–∫–æ–Ω—Å—Ç–∞–Ω—Ç—É)
      - [–ü–æ—á–µ–º—É `Hibernate.getClass(this)`?](#–ø–æ—á–µ–º—É-hibernategetclassthis)
      - [–ü–æ—á–µ–º—É `@BatchSize`?](#–ø–æ—á–µ–º—É-batchsize)
      - [–ü–æ—á–µ–º—É `allocationSize = 50`?](#–ø–æ—á–µ–º—É-allocationsize--50)
  - [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π —Å –ø–æ–º–æ—â—å—é TestContainers](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-—Å—É—â–Ω–æ—Å—Ç–µ–π-—Å-–ø–æ–º–æ—â—å—é-testcontainers)
    - [1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (pom.xml)](#1-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏-pomxml)
    - [2. –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏](#2-–±–∞–∑–æ–≤—ã–π-–∫–ª–∞—Å—Å-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
    - [3. –°–∞–º —Ç–µ—Å—Ç (UserRepositoryTest)](#3-—Å–∞–º-—Ç–µ—Å—Ç-userrepositorytest)
    - [–ù–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –≤ —ç—Ç–æ–º –∫–æ–¥–µ:](#–Ω–∞-—á—Ç–æ-–æ–±—Ä–∞—Ç–∏—Ç—å-–≤–Ω–∏–º–∞–Ω–∏–µ-–≤-—ç—Ç–æ–º-–∫–æ–¥–µ)


# –£—Ä–æ–≤–µ–Ω—å 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç –∏ –§–∏–ª–æ—Å–æ—Ñ–∏—è (Junior)

## 1. –û—Å–Ω–æ–≤—ã JDBC –∏ SQL (–ó–∞—á–µ–º –Ω–∞–º –≤–æ–æ–±—â–µ ORM?)

–ü—Ä–µ–∂–¥–µ —á–µ–º —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –º–∞–≥–∏–∏ Hibernate, –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –±–æ–ª—å, –∫–æ—Ç–æ—Ä—É—é –æ–Ω –ª–µ—á–∏—Ç.

### –ü—Ä–æ–±–ª–µ–º–∞ JDBC

–í "–≥–æ–ª–æ–º" Java –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω—É–∂–Ω–æ:

1. –û—Ç–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (`Connection`).
2. –°–æ–∑–¥–∞—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (`PreparedStatement`).
3. –í—Å—Ç–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL Injection).
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å.
5. –ü—Ä–æ–π—Ç–∏—Å—å —Ü–∏–∫–ª–æ–º –ø–æ `ResultSet`.
6. –°–º–∞–ø–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ `ResultSet` –≤ –ø–æ–ª—è Java-–æ–±—ä–µ–∫—Ç–∞ –≤—Ä—É—á–Ω—É—é.
7. –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –≤ –±–ª–æ–∫–µ `finally` –∏–ª–∏ `try-with-resources`.

**–ü—Ä–∏–º–µ—Ä –±–æ–ª–∏ (JDBC):**

```java
User user = new User();
try (Connection c = dataSource.getConnection();
     PreparedStatement ps = c.prepareStatement("SELECT * FROM users WHERE id = ?")) {
    ps.setLong(1, 1L);
    try (ResultSet rs = ps.executeQuery()) {
        if (rs.next()) {
            user.setId(rs.getLong("id"));
            user.setName(rs.getString("name"));
            // –ò —Ç–∞–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è...
        }
    }
} catch (SQLException e) {
    throw new RuntimeException(e);
}

```

### –†–µ—à–µ–Ω–∏–µ ORM

ORM (Object-Relational Mapping) –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—É–Ω–∫—Ç—ã 2‚Äì6. –í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL.

---

## 2. –í–≤–µ–¥–µ–Ω–∏–µ –≤ JPA –∏ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### JPA vs Hibernate

–≠—Ç–æ —Å–∞–º—ã–π —á–∞—Å—Ç—ã–π –≤–æ–ø—Ä–æ—Å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è—Ö.

* **JPA (Jakarta Persistence API)** ‚Äî —ç—Ç–æ **—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è** (–Ω–∞–±–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –ø—Ä–∞–≤–∏–ª). –≠—Ç–æ –∫–∞–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `List` –≤ Java.
* **Hibernate** ‚Äî —ç—Ç–æ **—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** —ç—Ç–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏. –≠—Ç–æ –∫–∞–∫ `ArrayList`.
* *Spring Data JPA* ‚Äî —ç—Ç–æ –µ—â–µ –æ–¥–Ω–∞ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–¥ JPA, —É–ø—Ä–æ—â–∞—é—â–∞—è –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (–æ –Ω–µ–π –ø–æ–∑–∂–µ).

### –ë–∞–∑–æ–≤—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏

–ß—Ç–æ–±—ã Hibernate –ø–æ–Ω—è–ª, –∫–∞–∫ —Å–≤—è–∑–∞—Ç—å –∫–ª–∞—Å—Å —Å —Ç–∞–±–ª–∏—Ü–µ–π, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∏–∑ –ø–∞–∫–µ—Ç–∞ `javax.persistence` (–∏–ª–∏ `jakarta.persistence` –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö).

```java
@Entity // –ì–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ —ç—Ç–æ—Ç –∫–ª–∞—Å—Å ‚Äî —Å—É—â–Ω–æ—Å—Ç—å –ë–î
@Table(name = "users") // –ò–º—è —Ç–∞–±–ª–∏—Ü—ã (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ –∫–ª–∞—Å—Å–∞)
public class User {

    @Id // –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
    @GeneratedValue(strategy = GenerationType.IDENTITY) // –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    private Long id;

    @Column(name = "full_name", nullable = false, length = 100)
    private String name;
    
    // –ì–µ—Ç—Ç–µ—Ä—ã, —Å–µ—Ç—Ç–µ—Ä—ã, –ø—É—Å—Ç–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è Hibernate!)
}

```

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ID (`@GeneratedValue`)

1. **AUTO**: Hibernate —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é (–æ–ø–∞—Å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞, –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ —Å–µ–±—è –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ).
2. **IDENTITY**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (MySQL `AUTO_INCREMENT`, Postgres `SERIAL`).
* *–ú–∏–Ω—É—Å:* Hibernate –Ω–µ –º–æ–∂–µ—Ç —É–∑–Ω–∞—Ç—å ID, –ø–æ–∫–∞ –Ω–µ —Å–¥–µ–ª–∞–µ—Ç `INSERT`. –≠—Ç–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç Batch-–≤—Å—Ç–∞–≤–∫—É (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é).


3. **SEQUENCE**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ä–µ–∫—Ç Sequence –≤ –ë–î (Oracle, Postgres).
* *–ü–ª—é—Å:* –°–∞–º—ã–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–∑–Ω–∞—Ç—å ID *–¥–æ* –≤—Å—Ç–∞–≤–∫–∏ –≤ –ë–î.


4. **TABLE**: –•—Ä–∞–Ω–∏—Ç —Å—á–µ—Ç—á–∏–∫–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ. –ú–µ–¥–ª–µ–Ω–Ω–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

---

## 3. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª Entity –∏ Persistence Context

–≠—Ç–æ **—Å–µ—Ä–¥—Ü–µ** Hibernate. –ï—Å–ª–∏ –≤—ã –ø–æ–π–º–µ—Ç–µ —ç—Ç–æ, –≤—ã –ø–æ–π–º–µ—Ç–µ 80% –ø—Ä–æ–±–ª–µ–º.

**Persistence Context (–ö–æ–Ω—Ç–µ–∫—Å—Ç –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏)** ‚Äî —ç—Ç–æ "–∫—ç—à –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è" (L1 Cache). –≠—Ç–æ –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏, –≥–¥–µ Hibernate —Ö—Ä–∞–Ω–∏—Ç –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –∑–∞–≥—Ä—É–∑–∏–ª –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–°–µ—Å—Å–∏–∏).

### 4 —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–∏ (Entity States)

1. **Transient (New):** –û–±—ä–µ–∫—Ç –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ `new`. Hibernate –æ –Ω–µ–º –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç. –í –ë–î –µ–≥–æ –Ω–µ—Ç.
2. **Managed (Persistent):** –û–±—ä–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ. –£ –Ω–µ–≥–æ –µ—Å—Ç—å ID. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–ª—è—Ö —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –±—É–¥—É—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∑–∞–ø–∏—Å–∞–Ω—ã –≤ –ë–î –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
3. **Detached:** –û–±—ä–µ–∫—Ç –µ—Å—Ç—å –≤ –ë–î, –Ω–æ —Å–µ—Å—Å–∏—è Hibernate —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞ –∏–ª–∏ –æ–±—ä–µ–∫—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∫–∏–Ω—É—Ç –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–µ–º *–Ω–µ* —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è.
4. **Removed:** –û–±—ä–µ–∫—Ç –ø–æ–º–µ—á–µ–Ω –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ. –ü—Ä–∏ –∫–æ–º–º–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç `DELETE`.

### Dirty Checking (–ì—Ä—è–∑–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)

–ù–æ–≤–∏—á–∫–∏ —á–∞—Å—Ç–æ –ø–∏—à—É—Ç –ª–∏—à–Ω–∏–π –∫–æ–¥, –≤—ã–∑—ã–≤–∞—è `save()` –∫–∞–∂–¥—ã–π —Ä–∞–∑.

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏):**

```java
@Transactional
public void updateName(Long id, String newName) {
    User user = repository.findById(id).get(); // User —Å—Ç–∞–ª Managed
    user.setName(newName);
    repository.save(user); // <--- –≠–¢–û –õ–ò–®–ù–ï–ï!
}

```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**

```java
@Transactional
public void updateName(Long id, String newName) {
    User user = repository.findById(id).get(); // –ó–∞–≥—Ä—É–∑–∏–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    user.setName(newName); 
    // –ú–µ—Ç–æ–¥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è -> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∫–æ–º–º–∏—Ç–∏—Ç—Å—è -> 
    // Hibernate –≤–∏–¥–∏—Ç, —á—Ç–æ –ø–æ–ª–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å -> –¥–µ–ª–∞–µ—Ç UPDATE —Å–∞–º.
}

```

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã EntityManager

* `persist(entity)`: –î–µ–ª–∞–µ—Ç Transient -> Managed. (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç INSERT).
* `merge(entity)`: –î–µ–ª–∞–µ—Ç Detached -> Managed. (–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–ø–∏—é –∏–∑ –ë–î, –∫–æ–ø–∏—Ä—É–µ—Ç –ø–æ–ª—è –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç managed-–∫–æ–ø–∏—é).
* `remove(entity)`: –î–µ–ª–∞–µ—Ç Managed -> Removed.
* `flush()`: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SQL –∫–æ–º–∞–Ω–¥—ã –∏–∑ –ø–∞–º—è—Ç–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–Ω–æ –Ω–µ –¥–µ–ª–∞–µ—Ç Commit).

---

**–ö–æ–Ω–µ—Ü –£—Ä–æ–≤–Ω—è 1.**

*–ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞:* Hibernate ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä SQL. –≠—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–æ–≤. –í—ã –º–µ–Ω—è–µ—Ç–µ –æ–±—ä–µ–∫—Ç—ã –≤ –ø–∞–º—è—Ç–∏, –∞ Hibernate —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –±–∞–∑–æ–π.

---

# –£—Ä–æ–≤–µ–Ω—å 2: –û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –ë–∞–∑–æ–≤—ã–π Spring Data (Middle)

## 4. –ú–∞–ø–ø–∏–Ω–≥ –æ—Ç–Ω–æ—à–µ–Ω–∏–π (Associations)

–ì–ª–∞–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∑–¥–µ—Å—å ‚Äî –ø–æ–Ω—è—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–Ω–æ–π –º–æ–¥–µ–ª—å—é –∏ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π.

* **–í –ë–î**: –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç—Ä–æ—è—Ç—Å—è —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ (Foreign Key). –ö–ª—é—á –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è *–≤ –æ–¥–Ω–æ–π* —Ç–∞–±–ª–∏—Ü–µ (–∫—Ä–æ–º–µ ManyToMany).
* **–í Java**: –û–±—ä–µ–∫—Ç—ã —Å—Å—ã–ª–∞—é—Ç—Å—è –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞. –°—Å—ã–ª–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã.

### –í–ª–∞–¥–µ—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (Owning Side) vs –û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (Inverse Side)

–≠—Ç–æ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –ª–æ–º–∞–µ—Ç—Å—è 90% –Ω–æ–≤–∏—á–∫–æ–≤.

* **Owning Side (–í–ª–∞–¥–µ—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞):** –≠—Ç–æ —Å—Ç–æ—Ä–æ–Ω–∞, —É –∫–æ—Ç–æ—Ä–æ–π –≤ —Ç–∞–±–ª–∏—Ü–µ –ë–î —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∞ `FOREIGN KEY`. Hibernate —Å–º–æ—Ç—Ä–∏—Ç **—Ç–æ–ª—å–∫–æ** –Ω–∞ —ç—Ç—É —Å—Ç–æ—Ä–æ–Ω—É, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É.
* **Inverse Side (–û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞):** –≠—Ç–æ —Å—Ç–æ—Ä–æ–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Å—Ç–æ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥—É—é, –∏—Å–ø–æ–ª—å–∑—É—è `mappedBy`. –û–Ω–∞ –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ (—á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ —É —é–∑–µ—Ä–∞), –Ω–æ Hibernate –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —ç—Ç–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–≤—è–∑–µ–π, –µ—Å–ª–∏ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–ª–∞–¥–µ—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞.

### –ü—Ä–∏–º–µ—Ä: One-To-Many (–û–¥–∏–Ω –∫–æ –ú–Ω–æ–≥–∏–º)

–ö–ª–∞—Å—Å–∏–∫–∞: –£ –æ–¥–Ω–æ–≥–æ `User` –µ—Å—Ç—å –º–Ω–æ–≥–æ `Post`.

**–í–ª–∞–¥–µ—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (Post):**

```java
@Entity
public class Post {
    @Id 
    @GeneratedValue 
    private Long id;

    private String title;

    @ManyToOne(fetch = FetchType.LAZY) // –í–°–ï–ì–î–ê LAZY (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —É—Ä.4)
    @JoinColumn(name = "user_id") // –ò–º—è –∫–æ–ª–æ–Ω–∫–∏ FK –≤ —Ç–∞–±–ª–∏—Ü–µ posts
    private User user; // <-- –≠—Ç–æ –ø–æ–ª–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤—è–∑—å—é!
    
    // –≥–µ—Ç—Ç–µ—Ä—ã, —Å–µ—Ç—Ç–µ—Ä—ã
}

```

**–û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (User):**

```java
@Entity
public class User {
    @Id 
    @GeneratedValue 
    private Long id;

    // mappedBy = "user" –æ–∑–Ω–∞—á–∞–µ—Ç: "–ò–¥–∏ –≤ –∫–ª–∞—Å—Å Post, –Ω–∞–π–¥–∏ –ø–æ–ª–µ 'user'. 
    // –í–æ—Ç –û–ù–û —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤—è–∑—å—é. –Ø –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ –¥–ª—è —á—Ç–µ–Ω–∏—è."
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Post> posts = new ArrayList<>();
    
    // –í–ê–ñ–ù–û: –•–µ–ª–ø–µ—Ä-–º–µ—Ç–æ–¥ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    public void addPost(Post post) {
        posts.add(post);
        post.setUser(this); // <-- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–≤—è–∑—ã–≤–∞–µ–º –≤–ª–∞–¥–µ—é—â—É—é —Å—Ç–æ—Ä–æ–Ω—É!
    }
}

```

> **–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Å–≤—è–∑–∏ –≤—ã –æ–±—è–∑–∞–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã!
> `user.getPosts().add(post)` ‚Äî –æ–±–Ω–æ–≤–∏—Ç —Ç–æ–ª—å–∫–æ –∫—ç—à –≤ Java.
> `post.setUser(user)` ‚Äî —Å–æ–∑–¥–∞—Å—Ç –∑–∞–ø–∏—Å—å –≤–æ –≤–Ω–µ—à–Ω–µ–º –∫–ª—é—á–µ –≤ –ë–î.

### –ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (Cascade) –∏ Orphan Removal

* **CascadeType.PERSIST**: –°–æ—Ö—Ä–∞–Ω—è—é —é–∑–µ—Ä–∞ -> –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –µ–≥–æ –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã.
* **CascadeType.ALL**: –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –≤—Å—ë (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ).
* **orphanRemoval = true**: –ï—Å–ª–∏ —è —É–¥–∞–ª—é –ø–æ—Å—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ `user.getPosts().remove(post)`, Hibernate –æ—Ç–ø—Ä–∞–≤–∏—Ç `DELETE` –∑–∞–ø—Ä–æ—Å –≤ –ë–î. –ë–µ–∑ —ç—Ç–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≤—è–∑—å –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–æ—Ä–≤–µ—Ç—Å—è (FK —Å—Ç–∞–Ω–µ—Ç NULL), –Ω–æ –∑–∞–ø–∏—Å—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è (–µ—Å–ª–∏ –Ω–µ—Ç constraint).

---

## 5. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å–æ Spring Data JPA

Spring Data JPA ‚Äî —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ Hibernate. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ –ø–∏—Å–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é DAO (Data Access Object) –≤—Ä—É—á–Ω—É—é. –í—ã –æ–±—ä—è–≤–ª—è–µ—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, Spring –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ –ª–µ—Ç—É (—á–µ—Ä–µ–∑ Proxy).

### –ò–µ—Ä–∞—Ä—Ö–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

1. **Repository**: –ú–∞—Ä–∫–µ—Ä–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
2. **CrudRepository**: –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã (`save`, `findById`, `delete`, `count`).
3. **JpaRepository**: –†–∞—Å—à–∏—Ä—è–µ—Ç PagingAndSortingRepository. –î–æ–±–∞–≤–ª—è–µ—Ç JPA-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã (flush, saveAllAndFlush). –û–±—ã—á–Ω–æ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –∏–º–µ–Ω–Ω–æ –æ—Ç –Ω–µ–≥–æ.

```java
public interface UserRepository extends JpaRepository<User, Long> {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞! Spring —Å–∞–º –ø–æ–π–º–µ—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å.
}

```

### –ú–∞–≥–∏—è Derived Queries (–ó–∞–ø—Ä–æ—Å—ã –∏–∑ –∏–º–µ–Ω–∏ –º–µ—Ç–æ–¥–∞)

Spring –ø–∞—Ä—Å–∏—Ç –∏–º—è –º–µ—Ç–æ–¥–∞ –∏ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –≤ SQL.

```java
// SELECT * FROM users WHERE email = ?
Optional<User> findByEmail(String email);

// SELECT * FROM users WHERE active = true AND age > ?
List<User> findByActiveTrueAndAgeGreaterThan(int age);

// SELECT count(*) FROM users WHERE name LIKE ?
long countByNameStartingWith(String prefix);

```

*–ü–ª—é—Å:* –ë—ã—Å—Ç—Ä–æ, —á–∏—Ç–∞–µ–º–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
*–ú–∏–Ω—É—Å:* –ò–º—è –º–µ—Ç–æ–¥–∞ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –º–æ–Ω—Å—Ç—Ä—É–æ–∑–Ω—ã–º (`findByNameAndAgeAndActiveTrueAnd...`).

### @Query (–ö–æ–≥–¥–∞ –∏–º—è –º–µ—Ç–æ–¥–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ)

–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ **JPQL** (Java Persistence Query Language). –í JPQL –º—ã –æ–ø–µ—Ä–∏—Ä—É–µ–º *–∏–º–µ–Ω–∞–º–∏ –∫–ª–∞—Å—Å–æ–≤ –∏ –ø–æ–ª–µ–π*, –∞ –Ω–µ —Ç–∞–±–ª–∏—Ü –∏ –∫–æ–ª–æ–Ω–æ–∫.

```java
@Query("SELECT u FROM User u WHERE u.email = :email AND u.active = true")
User findActiveUserByEmail(@Param("email") String email);

```

### –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ `List<User>`, –µ—Å–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–∏–ª–ª–∏–æ–Ω –∑–∞–ø–∏—Å–µ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Pageable`.

```java
// –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
Page<User> findAll(Pageable pageable);

// –í —Å–µ—Ä–≤–∏—Å–µ
// –°—Ç—Ä–∞–Ω–∏—Ü–∞ 0 (–ø–µ—Ä–≤–∞—è), —Ä–∞–∑–º–µ—Ä 10, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ ID —É–±—ã–≤–∞–Ω–∏—é
Pageable pageRequest = PageRequest.of(0, 10, Sort.by("id").descending());

Page<User> page = userRepository.findAll(pageRequest);
List<User> users = page.getContent(); // –°–∞–º–∏ –¥–∞–Ω–Ω—ã–µ
int totalPages = page.getTotalPages(); // –û–±—â–µ–µ –∫–æ–ª-–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü

```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞: –æ–¥–∏–Ω `SELECT ... LIMIT ... OFFSET` –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∏ –æ–¥–∏–Ω `SELECT COUNT(*)` –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü.

---

**–ö–æ–Ω–µ—Ü –£—Ä–æ–≤–Ω—è 2.**

–ú—ã –Ω–∞—É—á–∏–ª–∏—Å—å —Å–≤—è–∑—ã–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∏ –±—ã—Å—Ç—Ä–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º. –ù–æ –ø–æ–∫–∞ —á—Ç–æ –Ω–∞—à–∏ –º–∞–ø–ø–∏–Ω–≥–∏ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–µ.

---

# –£—Ä–æ–≤–µ–Ω—å 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –¢–∏–ø—ã (Senior)

## 6. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –º–∞–ø–ø–∏–Ω–≥

### –í—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã (Value Objects)

–ù–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—Å–ª—É–∂–∏–≤–∞—é—Ç —Å–≤–æ–µ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã. –í DDD (Domain Driven Design) –µ—Å—Ç—å –ø–æ–Ω—è—Ç–∏–µ **Value Object** (–æ–±—ä–µ–∫—Ç-–∑–Ω–∞—á–µ–Ω–∏–µ) ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, `Address` –∏–ª–∏ `Money`. –£ –Ω–∏—Ö –Ω–µ—Ç —Å–≤–æ–µ–≥–æ ID, –æ–Ω–∏ —á–∞—Å—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏.

```java
@Embeddable
public class Address {
    private String city;
    private String street;
    private String zipCode;
    // ...
}

@Entity
public class User {
    @Id @GeneratedValue private Long id;
    
    @Embedded // –ü–æ–ª—è Address "—Ä–∞—Å–ø–∞–∫—É—é—Ç—Å—è" –≤ —Ç–∞–±–ª–∏—Ü—É users
    @AttributeOverrides({ // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏
        @AttributeOverride(name = "city", column = @Column(name = "billing_city"))
    })
    private Address billingAddress;
}

```

*–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î:* –¢–∞–±–ª–∏—Ü–∞ `users` –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∫–æ–ª–æ–Ω–∫–∏ `id`, `billing_city`, `street`, `zipCode`. –¢–∞–±–ª–∏—Ü—ã `address` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

### –ú–∞–ø–ø–∏–Ω–≥ Enums

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç.** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Hibernate —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç Enum –∫–∞–∫ `ORDINAL` (—á–∏—Å–ª–æ–≤–æ–π –∏–Ω–¥–µ–∫—Å: 0, 1, 2...).
*–ü—Ä–æ–±–ª–µ–º–∞:* –ï—Å–ª–∏ –≤—ã –≤—Å—Ç–∞–≤–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–µ—Ä–µ–¥–∏–Ω—É Enum'–∞, –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å—ä–µ–¥—É—Ç. –î–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –ø—Ä–µ–≤—Ä–∞—Ç—è—Ç—Å—è –≤ –º—É—Å–æ—Ä.

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `STRING`.

```java
@Enumerated(EnumType.STRING) // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç "ACTIVE", "BANNED" —Ç–µ–∫—Å—Ç–æ–º
private UserStatus status;

```

### –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (Inheritance)

–ö–∞–∫ –ø–æ–ª–æ–∂–∏—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é –∫–ª–∞—Å—Å–æ–≤ Java –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é –ë–î?

–ï—Å—Ç—å —Ç—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

1. **SINGLE_TABLE (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
* –í—Å–µ –ø–æ–ª—è –≤—Å–µ—Ö –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ –ª–µ–∂–∞—Ç –≤ **–æ–¥–Ω–æ–π –≥–∏–≥–∞–Ω—Ç—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü–µ**.
* –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∞ `DTYPE` (Discriminator), –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∞—è –∫–ª–∞—Å—Å.
* *–ü–ª—é—Å:* –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ (–Ω–µ—Ç JOIN).
* *–ú–∏–Ω—É—Å:* –ù–µ–ª—å–∑—è –ø–æ—Å—Ç–∞–≤–∏—Ç—å `NOT NULL` –Ω–∞ –ø–æ–ª—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤. –¢–∞–±–ª–∏—Ü–∞ –ø—É—Ö–Ω–µ—Ç.


2. **JOINED (–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è):**
* –ï—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ —Ä–æ–¥–∏—Ç–µ–ª—è –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞.
* –ü—Ä–∏ –≤—ã–±–æ—Ä–∫–µ Hibernate –¥–µ–ª–∞–µ—Ç `JOIN`.
* *–ü–ª—é—Å:* –ß–∏—Å—Ç–∞—è —Å—Ö–µ–º–∞ –ë–î, —Ä–∞–±–æ—Ç–∞—é—Ç Constraints.
* *–ú–∏–Ω—É—Å:* –ú–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–∫–µ (–º–Ω–æ–≥–æ JOIN-–æ–≤) –∏ –≤—Å—Ç–∞–≤–∫–µ (–Ω–µ—Å–∫–æ–ª—å–∫–æ INSERT).


3. **TABLE_PER_CLASS:**
* –¢–∞–±–ª–∏—Ü–∞ —Ä–æ–¥–∏—Ç–µ–ª—è –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è (–æ–±—ã—á–Ω–æ –æ–Ω –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π). –£ –∫–∞–∂–¥–æ–≥–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ —Å–≤–æ—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏ (—Å–≤–æ–∏–º–∏ + —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º–∏).
* *–ú–∏–Ω—É—Å:* –ü–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–Ω–∞–π—Ç–∏ –≤—Å–µ—Ö `Animal`) –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `UNION ALL` –ø–æ –≤—Å–µ–º —Ç–∞–±–ª–∏—Ü–∞–º.



---

## 7. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

–ö–æ–≥–¥–∞ `findByEmail` —É–∂–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∏–ª—å—Ç—Ä –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–µ —Å 20 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –ø–æ–ª–æ–≤–∏–Ω–∞ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å null), –Ω–∞–º –Ω—É–∂–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

### Criteria API

–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± —Å—Ç—Ä–æ–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ, –±–µ–∑ —Å–∫–ª–µ–π–∫–∏ —Å—Ç—Ä–æ–∫ (String Concatenation), —á—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç SQL Injection. –û–¥–Ω–∞–∫–æ —á–∏—Å—Ç—ã–π JPA Criteria API –æ—á–µ–Ω—å –º–Ω–æ–≥–æ—Å–ª–æ–≤–µ–Ω –∏ —Å–ª–æ–∂–µ–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è.

### Spring Data Specifications

–≠—Ç–æ —ç–ª–µ–≥–∞–Ω—Ç–Ω–∞—è –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ Criteria API. –í—ã —Å–æ–∑–¥–∞–µ—Ç–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –∫—É—Å–æ—á–∫–∏ –ª–æ–≥–∏–∫–∏ ("–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏") –∏ –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç–µ –∏—Ö.

```java
// –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: "–¶–µ–Ω–∞ –±–æ–ª—å—à–µ —á–µ–º X"
public static Specification<Product> hasPriceGreaterThan(BigDecimal price) {
    return (root, query, criteriaBuilder) -> 
        criteriaBuilder.greaterThan(root.get("price"), price);
}

// –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: "–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ Y"
public static Specification<Product> isInCategory(String category) {
    return (root, query, criteriaBuilder) -> 
        criteriaBuilder.equal(root.get("category"), category);
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–µ:
repository.findAll(
    Specification.where(hasPriceGreaterThan(100))
    .and(isInCategory("Electronics"))
);

```

–î–ª—è —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ–ª–∂–µ–Ω –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å `JpaSpecificationExecutor`.

### Projections (–ü—Ä–æ–µ–∫—Ü–∏–∏)

–ß–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞: –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç—è–∂–µ–ª—É—é —Å—É—â–Ω–æ—Å—Ç—å `User` —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏, —á—Ç–æ–±—ã –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å "–ò–º—è" –∏ "–§–∞–º–∏–ª–∏—é" –≤ —Å–ø–∏—Å–∫–µ. –≠—Ç–æ —É–±–∏–≤–∞–µ—Ç –ø–∞–º—è—Ç—å.

Spring Data –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ü–∏–∏**:

```java
// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –≥–µ—Ç—Ç–µ—Ä–∞–º–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π
public interface UserSummary {
    String getFirstName();
    String getLastName();
    // Spring –¥–∞–∂–µ –º–æ–∂–µ—Ç –≤—ã—á–∏—Å–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ (Open Projection), –Ω–æ —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
    @Value("#{target.firstName + ' ' + target.lastName}")
    String getFullName(); 
}

// –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
List<UserSummary> findByActiveTrue(); 

```

Spring —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±–µ—Ä–µ—Ç **—Ç–æ–ª—å–∫–æ** —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è, –∞ –Ω–µ `SELECT *`.

---

**–ö–æ–Ω–µ—Ü –£—Ä–æ–≤–Ω—è 3.**

–í—ã –Ω–∞—É—á–∏–ª–∏—Å—å –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Å—Ç—Ä–æ–∏—Ç—å –≥–∏–±–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã. –ù–æ —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥ –≤–∞–º–∏ –≤—Å—Ç–∞–µ—Ç –≥–ª–∞–≤–Ω—ã–π –≤—Ä–∞–≥ –ª—é–±–æ–≥–æ Hibernate-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ ‚Äî **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**.

---

# –£—Ä–æ–≤–µ–Ω—å 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Expert)

## 8. –ü—Ä–æ–±–ª–µ–º–∞ N+1 –∏ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤—ã–±–æ—Ä–∫–∏ (Fetching)

–≠—Ç–æ –≤—Ä–∞–≥ ‚Ññ1 –≤ –º–∏—Ä–µ ORM.

### –ß—Ç–æ —Ç–∞–∫–æ–µ N+1?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`User`), –∏ —É –∫–∞–∂–¥–æ–≥–æ –µ—Å—Ç—å –≥–æ—Ä–æ–¥ (`City`).
–í—ã —Ö–æ—Ç–∏—Ç–µ –≤—ã–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –≥–æ—Ä–æ–¥–∞.

```java
List<User> users = userRepository.findAll(); // 1 –∑–∞–ø—Ä–æ—Å (SELECT * FROM users)

for (User user : users) {
    System.out.println(user.getCity().getName()); // N –∑–∞–ø—Ä–æ—Å–æ–≤!
}

```

–ï—Å–ª–∏ —É –≤–∞—Å 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, Hibernate —Å–¥–µ–ª–∞–µ—Ç:

1. –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤.
2. **1000** –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –¥–ª—è *–∫–∞–∂–¥–æ–≥–æ* —é–∑–µ—Ä–∞ (–ø–æ—Ç–æ–º—É —á—Ç–æ —Å–≤—è–∑–∏ LAZY –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏).

–ò—Ç–æ–≥–æ: 1 + 1000 = 1001 –∑–∞–ø—Ä–æ—Å. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞—Ö–ª–µ–±–Ω–µ—Ç—Å—è.

### –†–µ—à–µ–Ω–∏–µ 1: JOIN FETCH (JPQL)

–ú—ã —è–≤–Ω–æ –≥–æ–≤–æ—Ä–∏–º Hibernate: "–ö–æ–≥–¥–∞ –≥—Ä—É–∑–∏—à—å —é–∑–µ—Ä–æ–≤, —Å—Ä–∞–∑—É –ø–æ–¥—Ç—è–Ω–∏ –∏ –≥–æ—Ä–æ–¥–∞ –æ–¥–Ω–∏–º JOIN-–æ–º".

```java
@Query("SELECT u FROM User u JOIN FETCH u.city")
List<User> findAllWithCities();

```

*–†–µ–∑—É–ª—å—Ç–∞—Ç:* 1 –∑–∞–ø—Ä–æ—Å `SELECT ... FROM users INNER JOIN cities ...`.

### –†–µ—à–µ–Ω–∏–µ 2: @EntityGraph (Spring Data)

–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å JPQL.

```java
// –ü–æ–¥—Ç—è–Ω—É—Ç—å –ø–æ–ª–µ 'city' —Å—Ä–∞–∑—É
@EntityGraph(attributePaths = {"city"})
List<User> findAll();

```

### –†–µ—à–µ–Ω–∏–µ 3: Hibernate Batch Fetching

–ï—Å–ª–∏ –≤–∞–º –Ω–µ –Ω—É–∂–µ–Ω JOIN (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ –¥–µ–∫–∞—Ä—Ç–æ–≤–æ–º –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏), –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å Hibernate –≥—Ä—É–∑–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ "–ø–∞—á–∫–∞–º–∏".

```java
@Entity
public class User {
    @ManyToOne(fetch = FetchType.LAZY)
    @BatchSize(size = 20) // <--- –ú–∞–≥–∏—è –∑–¥–µ—Å—å
    private City city;
}

```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ø–µ—Ä–µ–±–æ—Ä–µ 1000 —é–∑–µ—Ä–æ–≤, Hibernate –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ø–æ 1, –∞ –ø–æ 20 ID –∑–∞ —Ä–∞–∑ (`WHERE id IN (?, ?, ...)`). –í–º–µ—Å—Ç–æ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –±—É–¥–µ—Ç 50.

### FetchType: EAGER vs LAZY

* **EAGER (–ñ–∞–¥–Ω–∞—è):** –ì—Ä—É–∑–∏—Ç —Å–≤—è–∑—å –≤—Å–µ–≥–¥–∞.
* *–û–ø–∞—Å–Ω–æ—Å—Ç—å:* –ï—Å–ª–∏ —É `User` –µ—Å—Ç—å `Group` (EAGER), –∞ —É `Group` –µ—Å—Ç—å `Permissions` (EAGER)... –∑–∞–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–≥–æ —é–∑–µ—Ä–∞ –≤—ã—Ç—è–Ω–µ—Ç –ø–æ–ª–±–∞–∑—ã.
* **–ü—Ä–∞–≤–∏–ª–æ:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **LAZY** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. `@OneToMany` –∏ `@ManyToMany` —É–∂–µ LAZY, –∞ –≤–æ—Ç `@ManyToOne` –∏ `@OneToOne` ‚Äî EAGER. **–í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ –∏—Ö –Ω–∞ LAZY!**



---

## 9. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (L1 –∏ L2)

### L1 Cache (Session Cache)

–í–∫–ª—é—á–µ–Ω –≤—Å–µ–≥–¥–∞. –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ï—Å–ª–∏ –≤—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏ –æ–±—ä–µ–∫—Ç –ø–æ ID, –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ –≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Hibernate –Ω–µ –ø–æ–π–¥–µ—Ç –≤ –ë–î, –∞ –≤–µ—Ä–Ω–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –ø–∞–º—è—Ç–∏.

### L2 Cache (Shared Cache)

–†–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ (–¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π). –¢—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (EhCache, Redis, Caffeine).

* **–ö–æ–≥–¥–∞ –ø–æ–ª–µ–∑–Ω–æ:** –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—â–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ.
* **–†–∏—Å–∫–∏:** –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è. –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–ø—Ä–∞–≤–∏—Ç –±–∞–∑—É —Ä—É–∫–∞–º–∏ (—á–µ—Ä–µ–∑ SQL –∫–æ–Ω—Å–æ–ª—å), –∫—ç—à –æ–± —ç—Ç–æ–º –Ω–µ —É–∑–Ω–∞–µ—Ç, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ.
* **Query Cache:** –ö—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (ID —Å—É—â–Ω–æ—Å—Ç–µ–π). –†–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –æ—á–µ–Ω—å —á–∞—Å—Ç–æ, –∞ –º–µ–Ω—è—é—Ç—Å—è –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ. –ü—Ä–∏ –ª—é–±–æ–º `UPDATE` –≤ —Ç–∞–±–ª–∏—Ü–µ, Query Cache –¥–ª—è —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.

---

## 10. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏ (Batch Processing)

–°—Ü–µ–Ω–∞—Ä–∏–π: –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å 10 000 –æ–±—ä–µ–∫—Ç–æ–≤.

**–ü–ª–æ—Ö–æ–π –≤–∞—Ä–∏–∞–Ω—Ç:**

```java
for (int i = 0; i < 10000; i++) {
    repository.save(new User(...));
}

```

–≠—Ç–æ 10 000 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `INSERT` –∑–∞–ø—Ä–æ—Å–æ–≤. –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ –∏–∑-–∑–∞ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫.

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (JDBC Batching):**
–ú—ã —Ö–æ—Ç–∏–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø–∞—á–∫–∞–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ 50 —à—Ç—É–∫ –∑–∞ –æ–¥–∏–Ω —Å–µ—Ç–µ–≤–æ–π –≤—ã–∑–æ–≤.

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `application.properties`:

```properties
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

```

**–ì–ª–∞–≤–Ω–∞—è –ª–æ–≤—É—à–∫–∞:**
Batching **–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**, –µ—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ID ‚Äî `IDENTITY` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è MySQL/Postgres). –ü–æ—Ç–æ–º—É —á—Ç–æ Hibernate –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å INSERT, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å ID, –∏ –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ª–æ–∂–∏—Ç—å —ç—Ç–æ "–≤ –ø–∞—á–∫—É".
*–†–µ—à–µ–Ω–∏–µ:* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SEQUENCE` (–¥–ª—è Postgres/Oracle) —Å `allocationSize` > 1 (—á—Ç–æ–±—ã Hibernate —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–ª ID –≤ –ø–∞–º—è—Ç–∏).

---

## 11. –ü—Ä–æ–∫—Å–∏ –∏ LazyInitializationException

–ó–Ω–∞–º–µ–Ω–∏—Ç–∞—è –æ—à–∏–±–∫–∞: `LazyInitializationException: could not initialize proxy - no Session`.

### –ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç?

1. –í—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å `User` (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞).
2. –ü–æ–ª–µ `posts` (LAZY) –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å. –í–º–µ—Å—Ç–æ —Å–ø–∏—Å–∫–∞ —Ç–∞–º –ª–µ–∂–∏—Ç **Proxy** (–æ–±—ä–µ–∫—Ç-–∑–∞–≥–ª—É—à–∫–∞).
3. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å. –°–µ—Å—Å–∏—è Hibernate —É–º–µ—Ä–ª–∞.
4. –í—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –∏–ª–∏ HTML-—à–∞–±–ª–æ–Ω–µ) –≤—ã–∑—ã–≤–∞–µ—Ç–µ `user.getPosts().size()`.
5. Proxy –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–π—Ç–∏ –≤ –ë–î, –Ω–æ "—Ç—Ä—É–±–∞" (Session) —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞. -> **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ**.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Proxy?

Hibernate –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ CGLIB –∏–ª–∏ ByteBuddy, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –≤–∞—à–µ–π —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–∞ –ª–µ—Ç—É. –í –Ω–µ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≥–µ—Ç—Ç–µ—Ä—ã. –ö–æ–≥–¥–∞ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ –≥–µ—Ç—Ç–µ—Ä, Proxy –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏ –¥–∞–Ω–Ω—ã–µ. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å (–µ—Å–ª–∏ —Å–µ—Å—Å–∏—è –∂–∏–≤–∞).

### –ö–∞–∫ –ª–µ—á–∏—Ç—å LazyInit?

1. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `JOIN FETCH` –∏–ª–∏ `@EntityGraph` (—Å–º. –ø—É–Ω–∫—Ç 8), —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—ë –Ω—É–∂–Ω–æ–µ, –ø–æ–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∂–∏–≤–∞.
2. **–°–ø–æ—Ä–Ω—ã–π —Å–ø–æ—Å–æ–± (Anti-Pattern):** Open Session In View (OSIV). –í Spring Boot –≤–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –û–Ω –¥–µ—Ä–∂–∏—Ç —Å–µ—Å—Å–∏—é –æ—Ç–∫—Ä—ã—Ç–æ–π –¥–æ —Å–∞–º–æ–≥–æ –∫–æ–Ω—Ü–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞. –≠—Ç–æ —É–¥–æ–±–Ω–æ (–æ—à–∏–±–æ–∫ –Ω–µ—Ç), –Ω–æ –¥–µ—Ä–∂–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î –¥–æ–ª—å—à–µ, —á–µ–º –Ω—É–∂–Ω–æ, —Å–Ω–∏–∂–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.

---

**–ö–æ–Ω–µ—Ü –£—Ä–æ–≤–Ω—è 4.**

–¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –ø–∏—Å–∞—Ç—å –±—ã—Å—Ç—Ä—ã–π –∫–æ–¥. –û—Å—Ç–∞–ª—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä—ã–≤–æ–∫ ‚Äî **–£—Ä–æ–≤–µ–Ω—å 5: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**. –¢–∞–º –º—ã —Ä–∞–∑–±–µ—Ä–µ–º, –∫–∞–∫ –Ω–µ –¥–∞—Ç—å –¥–≤—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∫—É–ø–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∏–ª–µ—Ç –≤ –∫–∏–Ω–æ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏) –∏ –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.

---

# –£—Ä–æ–≤–µ–Ω—å 5: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å, –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Architect)

## 12. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

–í Spring Data JPA —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ AOP (Aspect Oriented Programming).

### –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è @Transactional

–í–µ—à–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Ç–æ–¥ —Å–µ—Ä–≤–∏—Å–∞ (–∏–ª–∏ –∫–ª–∞—Å—Å).

* **–ü—Ä–∏ –≤—Ö–æ–¥–µ:** Spring –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π).
* **–ü—Ä–∏ –≤—ã—Ö–æ–¥–µ:** Spring –¥–µ–ª–∞–µ—Ç `Commit`.
* **–ü—Ä–∏ Exception:** Spring –¥–µ–ª–∞–µ—Ç `Rollback` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–æ–ª—å–∫–æ –¥–ª—è `RuntimeException`).

### Propagation (–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ)

–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –æ–¥–∏–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥–æ–π?

* **REQUIRED (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é):** "–ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –µ—Å—Ç—å ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –µ—ë. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–π –Ω–æ–≤—É—é". –°–∞–º—ã–π —á–∞—Å—Ç—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.
* **REQUIRES_NEW:** "–í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π –Ω–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. –¢–µ–∫—É—â—É—é (–µ—Å–ª–∏ –µ—Å—Ç—å) –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏".
* *–ö–µ–π—Å:* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–ª–∏ –∞—É–¥–∏—Ç. –î–∞–∂–µ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —É–ø–∞–¥–µ—Ç –∏ –æ—Ç–∫–∞—Ç–∏—Ç—Å—è, –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è.


* **MANDATORY:** "–Ø —Ç—Ä–µ–±—É—é, —á—Ç–æ–±—ã –º–µ–Ω—è –≤—ã–∑—ã–≤–∞–ª–∏ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ò–Ω–∞—á–µ –±—Ä–æ—à—É –∏—Å–∫–ª—é—á–µ–Ω–∏–µ".

### –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ (Isolation Levels)

–†–µ–≥—É–ª–∏—Ä—É—é—Ç –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö.

* **READ_COMMITTED:** (–°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è Postgres/Oracle). –í–∏–¥–∏–º —Ç–æ–ª—å–∫–æ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç "–ì—Ä—è–∑–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è".
* **REPEATABLE_READ:** (–°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è MySQL). –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –º—ã –ø—Ä–æ—á–∏—Ç–∞–ª–∏ —Å—Ç—Ä–æ–∫—É –¥–≤–∞–∂–¥—ã –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏.
* **SERIALIZABLE:** –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞. –°–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π, –Ω–æ —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å.

---

## 13. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (Locking)

–ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ?

### Optimistic Locking (–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)

–ú—ã –Ω–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –±—É–¥—É—Ç —Ä–µ–¥–∫–∏. –ú—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
–î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –≤–µ—Ä—Å–∏–∏ –≤ —Å—É—â–Ω–æ—Å—Ç—å.

```java
@Entity
public class Wallet {
    @Id private Long id;
    private BigDecimal balance;

    @Version // <--- –í—Å—è –º–∞–≥–∏—è –∑–¥–µ—Å—å
    private Long version;
}

```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ê —Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ—à–µ–ª–µ–∫ (version = 1).
2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë —Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ—à–µ–ª–µ–∫ (version = 1).
3. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ê –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç. Hibernate –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: `UPDATE wallet SET balance=?, version=2 WHERE id=? AND version=1`. –£—Å–ø–µ—Ö.
4. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å. Hibernate —à–ª–µ—Ç –∑–∞–ø—Ä–æ—Å: `WHERE ... AND version=1`. –ù–æ –≤–µ—Ä—Å–∏—è –≤ –±–∞–∑–µ —É–∂–µ 2!
5. –ó–∞–ø—Ä–æ—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç 0 —Å—Ç—Ä–æ–∫.
6. Hibernate –±—Ä–æ—Å–∞–µ—Ç **`OptimisticLockException`**.
7. –í—ã –ª–æ–≤–∏—Ç–µ –æ—à–∏–±–∫—É –∏ –ø—Ä–æ—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ.

### Pessimistic Locking (–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)

–ú—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —Ö—É–¥—à–µ–µ (–∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–Ω–æ–≥–æ), –ø–æ—ç—Ç–æ–º—É –±–ª–æ–∫–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î —Å—Ä–∞–∑—É –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏.

```java
@Lock(LockModeType.PESSIMISTIC_WRITE)
@Query("SELECT w FROM Wallet w WHERE w.id = :id")
Optional<Wallet> findByIdAndLock(Long id);

```

–≠—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL: `SELECT ... FOR UPDATE`.
–ü–æ–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –≤—ã–∑–≤–∞–≤—à–∞—è —ç—Ç–æ—Ç –º–µ—Ç–æ–¥, –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, **–Ω–∏–∫—Ç–æ** –¥—Ä—É–≥–æ–π –Ω–µ —Å–º–æ–∂–µ—Ç –Ω–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å (–≤ —Ä–µ–∂–∏–º–µ update), –Ω–∏ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É. –û—Å—Ç–∞–ª—å–Ω—ã–µ –±—É–¥—É—Ç –∂–¥–∞—Ç—å (–≤–∏—Å–µ—Ç—å).

---

## 14. –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (Schema Management)

### –ü—Ä–æ–±–ª–µ–º–∞ `ddl-auto`

–í `application.properties` —á–∞—Å—Ç–æ –ø–∏—à—É—Ç: `spring.jpa.hibernate.ddl-auto=update`.
–≠—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç Hibernate –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –ø—ã—Ç–∞—Ç—å—Å—è `ALTER TABLE` –≤ –±–∞–∑–µ.

* **–ù–∞ –ø—Ä–æ–¥–µ —ç—Ç–æ –ö–ê–¢–ê–°–¢–†–û–§–ê.** Hibernate –º–æ–∂–µ—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã.
* –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### –†–µ—à–µ–Ω–∏–µ: Flyway –∏–ª–∏ Liquibase

–≠—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ë–î.
–í—ã –ø–∏—à–µ—Ç–µ SQL-—Å–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `resources/db/migration`:

* `V1__init_schema.sql` (CREATE TABLE users...)
* `V2__add_index_to_users.sql` (CREATE INDEX...)

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã —É–∂–µ –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –∏ –Ω–∞–∫–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ.
**ddl-auto –Ω—É–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –≤ `validate` –∏–ª–∏ `none`.**

---

## 15. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–±—É–¥—å—Ç–µ –ø—Ä–æ –º–æ–∫–∏ (`Mockito`) –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤. –ï—Å–ª–∏ –≤—ã –∑–∞–º–æ–∫–∞–µ—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –≤—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –≤–∞—à –º–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç. –í—ã –Ω–µ —É–∑–Ω–∞–µ—Ç–µ, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ SQL –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è.

### @DataJpaTest

–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è Spring Boot, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–Ω–∏–º–∞–µ—Ç —É—Ä–µ–∑–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (—Ç–æ–ª—å–∫–æ JPA –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã), —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ.

### H2 vs Testcontainers

* **H2 (In-memory DB):** –ë—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ. –°–∏–Ω—Ç–∞–∫—Å–∏—Å H2 –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Postgres. –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ—Ç –Ω–∞ H2, –Ω–æ —É–ø–∞–¥–µ—Ç –Ω–∞ –ø—Ä–æ–¥–µ –∏–∑-–∑–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ JSONB –ø–æ–ª—è –∏–ª–∏ –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
* **Testcontainers:** –ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏.
–í Docker –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è **—Ä–µ–∞–ª—å–Ω—ã–π** Postgres (—á–∏—Å—Ç—ã–π, –ø—É—Å—Ç–æ–π) —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞. –¢–µ—Å—Ç—ã –∏–¥—É—Ç –¥–æ–ª—å—à–µ, –Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

```java
@DataJpaTest
@AutoConfigureTestDatabase(replace = Replace.NONE) // –ù–µ –ø–æ–¥–º–µ–Ω—è—Ç—å –Ω–∞ H2!
class UserRepositoryTest extends AbstractContainerBaseTest { 
    // ... —Ç–µ—Å—Ç—ã
}

```

---

**–ö–æ–Ω–µ—Ü –£—Ä–æ–≤–Ω—è 5.**

–í—ã –ø—Ä–æ—à–ª–∏ –ø—É—Ç—å –æ—Ç `SELECT *` –¥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.

**–í–∞—à –ø—É—Ç—å –∫ —ç–∫—Å–ø–µ—Ä—Ç—É –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:**

1. –ü–µ—Ä–µ—Å—Ç–∞–Ω—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EAGER fetch.
2. –ù–∞—É—á–∏—Ç–µ—Å—å —á–∏—Ç–∞—Ç—å –ª–æ–≥–∏ Hibernate (–≤–∫–ª—é—á–∏—Ç–µ `spring.jpa.show-sql=true` –∏ –Ω–∞—É—á–∏—Ç–µ—Å—å –≤–∏–¥–µ—Ç—å N+1 –≥–ª–∞–∑–∞–º–∏).
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Testcontainers.
4. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ddl-auto=update` –Ω–∞ –ø—Ä–æ–¥–µ.

---

# –£—Ä–æ–≤–µ–Ω—å 6. –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞–Ω–Ω—ã—Ö: –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –∏ Soft Delete

–í —ç—Ç–æ–π –≥–ª–∞–≤–µ –º—ã –Ω–∞—É—á–∏–º—Å—è –¥–≤—É–º –≤–µ—â–∞–º:

1. –•—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –≤–∏–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º), –∞ –≤ Java —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º–∏ –≤ –¥—Ä—É–≥–æ–º.
2. –£–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –≤ –±–∞–∑–µ (Soft Delete).

---

## 16. Attribute Converters (`@Converter`)

–ò–Ω–æ–≥–¥–∞ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ –∏ –≤ Java –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.

* **–ü—Ä–∏–º–µ—Ä 1:** –í –±–∞–∑–µ –ø–æ–ª–µ `gender` ‚Äî —ç—Ç–æ `CHAR(1)` ('M', 'F'), –∞ –≤ Java —ç—Ç–æ `Enum Gender`. (–†–µ—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `@Enumerated`, –Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≥–∏–±—á–µ).
* **–ü—Ä–∏–º–µ—Ä 2 (–ö–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞):** –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ. –í –±–∞–∑–µ –º—ã —Ö–æ—Ç–∏–º —Ö—Ä–∞–Ω–∏—Ç—å `AES:83h1289...`, –∞ –≤ Java –≤–∏–¥–µ—Ç—å `1234-5678-9000`.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

Hibernate –≤—ã–∑—ã–≤–∞–µ—Ç –≤–∞—à –∫–æ–¥ **–ø–µ—Ä–µ–¥** –≤—Å—Ç–∞–≤–∫–æ–π –≤ –ë–î (`convertToDatabaseColumn`) –∏ **—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ** —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î (`convertToEntityAttribute`).

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º —Å–∞–º –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä:

```java
@Converter
// <–¢–∏–ø_–≤_Java, –¢–∏–ø_–≤_–ë–î>
public class CryptoConverter implements AttributeConverter<String, String> {

    @Override
    public String convertToDatabaseColumn(String sensitiveData) {
        if (sensitiveData == null) return null;
        return encrypt(sensitiveData); // –í–∞—à –º–µ—Ç–æ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (AES/RSA)
    }

    @Override
    public String convertToEntityAttribute(String dbData) {
        if (dbData == null) return null;
        return decrypt(dbData); // –í–∞—à –º–µ—Ç–æ–¥ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
    }
}

```

–ü—Ä–∏–º–µ–Ω—è–µ–º –≤ —Å—É—â–Ω–æ—Å—Ç–∏:

```java
@Entity
public class User {
    @Id @GeneratedValue private Long id;

    @Convert(converter = CryptoConverter.class)
    private String creditCardNumber; 
    // –í Java —ç—Ç–æ "4444...", –≤ –ë–î –ª–µ–∂–∏—Ç "x8s7f6..."
}

```

### ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏

1. **–ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—é:** –í—ã **–Ω–µ —Å–º–æ–∂–µ—Ç–µ** —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–∫–∞—Ç—å –ø–æ —ç—Ç–æ–º—É –ø–æ–ª—é (`findByCreditCardNumber`). –ë–∞–∑–∞ –≤–∏–¥–∏—Ç –∞–±—Ä–∞–∫–∞–¥–∞–±—Ä—É. –ü–æ–∏—Å–∫ –ø—Ä–∏–¥–µ—Ç—Å—è –¥–µ–ª–∞—Ç—å –≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (—á—Ç–æ –º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ).
2. **`autoApply = true`:** –ú–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å `@Converter(autoApply = true)`. –¢–æ–≥–¥–∞ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è **–∫–æ –≤—Å–µ–º** –ø–æ–ª—è–º —Ç–∏–ø–∞ `String` –≤–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–µ. –≠—Ç–æ –æ–ø–∞—Å–Ω–æ.
3. **–ß–∞—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `JPQL` –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é `select u.creditCardNumber from User u`, –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–µ—Ç. –ù–æ –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Native SQL (`select credit_card from users`), –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É.

---

## 17. Soft Delete (–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)

–í –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ (`DELETE`) —á–∞—Å—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ. –ù—É–∂–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è, –∞—É–¥–∏—Ç –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

**–ó–∞–¥–∞—á–∞:**

1. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `repository.delete(id)` –¥–µ–ª–∞—Ç—å `UPDATE users SET deleted = true WHERE id = ?`.
2. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `findAll()` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ Hibernate 6.3+)

–†–∞–Ω—å—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é `@Where`, –Ω–æ –æ–Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∞ **Deprecated**. –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º `@SQLDelete` –∏ `@SQLRestriction`.

```java
@Entity
@Table(name = "users")
// 1. –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—É DELETE
@SQLDelete(sql = "UPDATE users SET deleted = true WHERE id = ?")
// 2. –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä –∫–æ –í–°–ï–ú –∑–∞–ø—Ä–æ—Å–∞–º —á—Ç–µ–Ω–∏—è (SELECT, JOIN –∏ —Ç.–¥.)
@SQLRestriction("deleted = false") 
public class User {

    @Id @GeneratedValue private Long id;

    private String username;

    // –§–ª–∞–≥ —É–¥–∞–ª–µ–Ω–∏—è
    @Column(nullable = false)
    private boolean deleted = false;
}

```

### –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ –∫–æ–¥–µ

```java
userRepository.deleteById(1L); 
// Hibernate –≤—ã–ø–æ–ª–Ω–∏—Ç: UPDATE users SET deleted = true WHERE id = 1

List<User> users = userRepository.findAll();
// Hibernate –≤—ã–ø–æ–ª–Ω–∏—Ç: SELECT * FROM users WHERE deleted = false

```

### ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ (Expert Level)

–≠—Ç–æ —Ç–µ–º–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π —á–∞—Å—Ç–æ "–ª–æ–º–∞—é—Ç –∫–æ–ø—å—è".

1. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (Unique Constraints):**
* –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —É `username` —Å—Ç–æ–∏—Ç `UNIQUE`.
* –í—ã —É–¥–∞–ª—è–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "admin" (–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `deleted=true`).
* –í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "admin".
* **–û—à–∏–±–∫–∞ –ë–î!** –§–∏–∑–∏—á–µ—Å–∫–∏ —Å—Ç–∞—Ä–∞—è –∑–∞–ø–∏—Å—å "admin" –≤—Å—ë –µ—â–µ —Ç–∞–º.
* *–†–µ—à–µ–Ω–∏–µ:* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "Partial Index" –≤ PostgreSQL:
`CREATE UNIQUE INDEX idx_username ON users (username) WHERE deleted = false;`


2. **Native SQL:**
* –ï—Å–ª–∏ –≤—ã –Ω–∞–ø–∏—à–µ—Ç–µ `@Query(value = "SELECT * FROM users", nativeQuery = true)`, Hibernate **–Ω–µ –¥–æ–±–∞–≤–∏—Ç** —É—Å–ª–æ–≤–∏–µ `deleted = false`. –ù–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Å—É—â–Ω–æ—Å—Ç–∏. –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏.


3. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:**
* –ï—Å–ª–∏ —É `User` –µ—Å—Ç—å `List<Order>`, –∏ —É —Å–≤—è–∑–∏ —Å—Ç–æ–∏—Ç `CascadeType.REMOVE`, —Ç–æ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ User Hibernate –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å –∏ Order.
* –ï—Å–ª–∏ —É Order —Ç–æ–∂–µ —Å—Ç–æ–∏—Ç `@SQLDelete`, –≤—Å—ë –ø—Ä–æ–π–¥–µ—Ç —Ö–æ—Ä–æ—à–æ (–±—É–¥–µ—Ç —Ü–µ–ø–æ—á–∫–∞ Update-–æ–≤).
* –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî Hibernate —Å–¥–µ–ª–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π `DELETE` –¥–ª—è –æ—Ä–¥–µ—Ä–æ–≤.



---

## 18. Entity Listeners (–û–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã)

JPA –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∏–∑ –º–µ—Ç–æ–¥–æ–≤ `save/update` –≤–æ –≤–Ω–µ—à–Ω–∏–µ –∫–ª–∞—Å—Å—ã.

**–ü—Ä–∏–º–µ—Ä:** –ú—ã —Ö–æ—Ç–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–æ –Ω–µ —Ö–æ—Ç–∏–º –∑–∞—Å–æ—Ä—è—Ç—å –∫–æ–¥ –°–µ—Ä–≤–∏—Å–∞ –∏–ª–∏ –°—É—â–Ω–æ—Å—Ç–∏.

```java
public class UserAuditListener {

    @PrePersist // –ü–µ—Ä–µ–¥ INSERT
    public void beforeCreate(User user) {
        System.out.println("–°–æ–∑–¥–∞–µ–º —é–∑–µ—Ä–∞: " + user.getUsername());
    }

    @PostPersist // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ INSERT
    public void afterCreate(User user) {
        // –ü—Ä–∏–º–µ—Ä: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ Kafka
        // EmailService.sendWelcomeEmail(user.getEmail()); 
    }
}

// –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫ —Å—É—â–Ω–æ—Å—Ç–∏
@Entity
@EntityListeners(UserAuditListener.class)
public class User { ... }

```

### ü™® –í–∞–∂–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

–í–Ω—É—Ç—Ä–∏ `EntityListener` **–Ω–µ–ª—å–∑—è** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ EntityManager –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ë–î. –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ "flush". –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥—Ä—É–≥—É—é —Å—É—â–Ω–æ—Å—Ç—å –∑–¥–µ—Å—å –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é –∏–ª–∏ —Ä–µ–∫—É—Ä—Å–∏–∏.

---

**–ö–æ–Ω–µ—Ü –£—Ä–æ–≤–Ω—è 6.**
–ú—ã –Ω–∞—É—á–∏–ª–∏—Å—å "–æ–±–º–∞–Ω—ã–≤–∞—Ç—å" –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: —Ö—Ä–∞–Ω–∏—Ç—å –æ–¥–Ω–æ, –∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥—Ä—É–≥–æ–µ (–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã), –∏ –¥–µ–ª–∞—Ç—å –≤–∏–¥, —á—Ç–æ —É–¥–∞–ª–∏–ª–∏, —Ö–æ—Ç—è –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä—è—Ç–∞–ª–∏ (Soft Delete).

---

# –£—Ä–æ–≤–µ–Ω—å 7. –°–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–î: Multi-tenancy –∏ –†–µ–ø–ª–∏–∫–∞—Ü–∏—è

## 19. Multi-tenancy (–ú—É–ª—å—Ç–∏-–∞—Ä–µ–Ω–¥–Ω–æ—Å—Ç—å)

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –ø–∏—à–µ—Ç–µ CRM-—Å–∏—Å—Ç–µ–º—É (SaaS). –ï—é –ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–º–ø–∞–Ω–∏–∏ "–†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞" (Tenant A) –∏ "–í–µ–∫—Ç–æ—Ä" (Tenant B).
**–ì–ª–∞–≤–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –î–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ–ø–∞—Å—Ç—å –∫ –¥—Ä—É–≥–æ–π.

### –¢—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **Discriminator Column (–û–±—â–∞—è —Å—Ö–µ–º–∞):**
* –í—Å–µ –∂–∏–≤—É—Ç –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `users`. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∞ `tenant_id`.
* *–ü–ª—é—Å:* –î–µ—à–µ–≤–æ, –ª–µ–≥–∫–æ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø, –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç—ã–µ.
* *–ú–∏–Ω—É—Å:* –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–±—ã–ª –¥–æ–±–∞–≤–∏—Ç—å `WHERE tenant_id = ?` –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ -> —É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö. **Hibernate —Ä–µ—à–∞–µ—Ç —ç—Ç–æ —á–µ—Ä–µ–∑ `@TenantId` (–≤ –≤–µ—Ä—Å–∏–∏ 6+) –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã.**


2. **Separate Schema (–†–∞–∑–¥–µ–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã):**
* –û–¥–Ω–∞ –ë–î, –Ω–æ —Ä–∞–∑–Ω—ã–µ —Å—Ö–µ–º—ã: `schema_tenant_a`, `schema_tenant_b`.
* *–ü–ª—é—Å:* –•–æ—Ä–æ—à–∞—è –∏–∑–æ–ª—è—Ü–∏—è, –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ö–µ–º—ã.
* *–ú–∏–Ω—É—Å:* –°–ª–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ (Flyway –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ 100 —Å—Ö–µ–º–∞–º).


3. **Separate Database (–†–∞–∑–¥–µ–ª—å–Ω—ã–µ –±–∞–∑—ã):**
* –£ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —Å–≤–æ–π URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
* *–ü–ª—é—Å:* –ü–æ–ª–Ω–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è (VIP –∫–ª–∏–µ–Ω—Ç—ã –Ω–∞ –±—ã—Å—Ç—Ä–æ–º –∂–µ–ª–µ–∑–µ).
* *–ú–∏–Ω—É—Å:* –û—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º.


### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ Hibernate (Separate Schema)

Hibernate –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É —ç—Ç–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞. –í–∞–º –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–≤–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

#### –®–∞–≥ 1. –ö—Ç–æ —Å—Ç—É—á–∏—Ç—Å—è? (`CurrentTenantIdentifierResolver`)

–ù–∞–º –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π –∫–ª–∏–µ–Ω—Ç —Å–µ–π—á–∞—Å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å (–æ–±—ã—á–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞ –∏–ª–∏ –ø–æ–¥–¥–æ–º–µ–Ω–∞ `client.app.com`).

```java
@Component
public class TenantResolver implements CurrentTenantIdentifierResolver {

    @Override
    public String resolveCurrentTenantIdentifier() {
        // –î–æ—Å—Ç–∞–µ–º ID –∏–∑ ThreadLocal (–∫—É–¥–∞ –µ–≥–æ –ø–æ–ª–æ–∂–∏–ª —Ñ–∏–ª—å—Ç—Ä –∑–∞–ø—Ä–æ—Å–æ–≤)
        String tenantId = TenantContext.getCurrentTenant();
        return tenantId != null ? tenantId : "default_schema";
    }

    @Override
    public boolean validateExistingCurrentSessions() {
        return true;
    }
}

```

#### –®–∞–≥ 2. –î–∞–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (`MultiTenantConnectionProvider`)

Hibernate –ø—Ä–æ—Å–∏—Ç: "–î–∞–π –º–Ω–µ Connection –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ 'tenant_a'". –í—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ö–µ–º—É.

```java
@Component
public class SchemaConnectionProvider implements MultiTenantConnectionProvider {

    @Autowired
    private DataSource dataSource;

    @Override
    public Connection getConnection(String tenantIdentifier) throws SQLException {
        Connection connection = dataSource.getConnection();
        // –ú–∞–≥–∏—è Postgres: –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º search_path –Ω–∞ –Ω—É–∂–Ω—É—é —Å—Ö–µ–º—É
        connection.setSchema(tenantIdentifier); 
        return connection;
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã releaseConnection –∏ —Ç.–¥.
}

```

#### ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ (Expert)

1. **Connection Pooling:** –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é **Separate Database**, –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å 100 –ø—É–ª–æ–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (HikariCP) –ø–æ 10 –∫–æ–Ω–Ω–µ–∫—Ç–æ–≤. 1000 –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–∫–µ—Ç–æ–≤ –ø–æ–ª–æ–∂–∞—Ç —Å–µ—Ä–≤–µ—Ä. –ü—Ä–∏–¥–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –±–µ–∑ –ø—É–ª–∏–Ω–≥–∞ –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ (PgBouncer).
2. **–ö—ç—à Hibernate:** L2 Cache –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –æ —Ç–µ–Ω–∞–Ω—Ç–∞—Ö. –ò–Ω–∞—á–µ Tenant A –ø–æ–ª—É—á–∏—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Tenant B. –í EhCache/Redis —ç—Ç–æ —Ä–µ—à–∞–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º TenantID –≤ –∫–ª—é—á –∫—ç—à–∞.

---

## 20. Read/Write Splitting (–†–µ–ø–ª–∏–∫–∞—Ü–∏—è)

–ö–æ–≥–¥–∞ `SELECT` –∑–∞–ø—Ä–æ—Å–æ–≤ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –±–∞–∑—É —Ä–∞–∑–¥–µ–ª—è—é—Ç:

* **Master (Leader):** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `INSERT`, `UPDATE`, `DELETE`.
* **Replica (Follower/Slave):** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ `SELECT`. –î–∞–Ω–Ω—ã–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è —Å –ú–∞—Å—Ç–µ—Ä–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

**–ó–∞–¥–∞—á–∞:** –ó–∞—Å—Ç–∞–≤–∏—Ç—å Spring –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–∏—à—É—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ú–∞—Å—Ç–µ—Ä–∞, –∞ —á–∏—Ç–∞—é—â–∏–µ ‚Äî –Ω–∞ –†–µ–ø–ª–∏–∫—É.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: `AbstractRoutingDataSource`

–í Spring –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å `AbstractRoutingDataSource`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—Ç–≤–æ—Ä—è–µ—Ç—Å—è –æ–¥–Ω–∏–º DataSource, –Ω–æ –≤–Ω—É—Ç—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–µ–∞–ª—å–Ω—ã–º–∏.

```java
// 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø—ã
public enum DataSourceType { READ_ONLY, READ_WRITE }

// 2. –õ–æ–≥–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
public class TransactionRoutingDataSource extends AbstractRoutingDataSource {
    @Override
    protected Object determineCurrentLookupKey() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º: —Ç–µ–∫—É—â–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ReadOnly?
        if (TransactionSynchronizationManager.isCurrentTransactionReadOnly()) {
            return DataSourceType.READ_ONLY;
        }
        return DataSourceType.READ_WRITE;
    }
}

```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

1. –°–æ–∑–¥–∞–µ–º –¥–≤–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö DataSource (MasterDS, ReplicaDS).
2. –°–∫–∞—Ä–º–ª–∏–≤–∞–µ–º –∏—Ö –Ω–∞—à–µ–º—É `TransactionRoutingDataSource`.
3. –í —Å–µ—Ä–≤–∏—Å–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é:

```java
@Service
public class UserService {

    @Transactional(readOnly = true) // –ü–æ–π–¥–µ—Ç –Ω–∞ Replica
    public User getUser(Long id) { ... }

    @Transactional // (readOnly = false) –ü–æ–π–¥–µ—Ç –Ω–∞ Master
    public void createUser(User user) { ... }
}

```

### ü™® –ì–ª–∞–≤–Ω—ã–π –ø–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å: Replication Lag

–≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

**–°—Ü–µ–Ω–∞—Ä–∏–π:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å (`Master DB`). –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è (`SELECT` -> `Replica DB`).
3. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç 100-500–º—Å. –î–∞–Ω–Ω—ã–µ –µ—â–µ –Ω–µ –¥–æ–ª–µ—Ç–µ–ª–∏ –¥–æ –†–µ–ø–ª–∏–∫–∏.
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ. –û–Ω –ø–∞–Ω–∏–∫—É–µ—Ç –∏ –Ω–∞–∂–∏–º–∞–µ—Ç F5.

**–†–µ—à–µ–Ω–∏—è:**

1. **–ì—Ä—É–±–æ–µ:** –ü–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –¥–µ–ª–∞—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Å –ú–∞—Å—Ç–µ—Ä–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–ª–∞–≥ –≤ —Å–µ—Å—Å–∏–∏).
2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ:** –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–æ—Ñ–∏–ª—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) –≤—Å–µ–≥–¥–∞ —á–∏—Ç–∞—Ç—å —Å –ú–∞—Å—Ç–µ—Ä–∞ (`@Transactional(readOnly = false)` –¥–∞–∂–µ –¥–ª—è SELECT). –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ (–ª–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π) ‚Äî —Å –†–µ–ø–ª–∏–∫–∏.

---

**–ö–æ–Ω–µ—Ü –£—Ä–æ–≤–Ω—è 7.**
–í—ã —É–∑–Ω–∞–ª–∏, –∫–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ.

* **Multi-tenancy** –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ—Ç–Ω—è–º –∫–ª–∏–µ–Ω—Ç–æ–≤.
* **Replication** –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ–≥—Ä–æ–º–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ.

---

# –£—Ä–æ–≤–µ–Ω—å 8. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

## 21. –ü—Ä–æ–±–ª–µ–º–∞ —á–∏—Å—Ç–æ–≥–æ JPA –∏ Native Queries

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π JPQL —Ö–æ—Ä–æ—à –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤, –Ω–æ –ø–ª–æ—Ö –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.
–ß–µ–≥–æ –Ω–µ—Ç –≤ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö (–∏–ª–∏ –Ω–µ—É–¥–æ–±–Ω–æ –≤ –Ω–æ–≤—ã—Ö):

* **Window Functions** (`ROW_NUMBER() OVER...`, `RANK()`, `PARTITION BY`).
* **CTEs** (`WITH RECURSIVE` ‚Äî –¥–ª—è –¥–µ—Ä–µ–≤—å–µ–≤ –∏ –∏–µ—Ä–∞—Ä—Ö–∏–π).
* **Slozhnyye JOIN-—ã** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `LATERAL JOIN`).

### –†–µ—à–µ–Ω–∏–µ 1: Native Query (–õ–æ–±–æ–≤–∞—è –∞—Ç–∞–∫–∞)

–ú—ã –ø–∏—à–µ–º —á–∏—Å—Ç—ã–π SQL –≤–Ω—É—Ç—Ä–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏.

```java
@Query(value = """
    SELECT u.username, sum(o.total) as total_sum,
           RANK() OVER (ORDER BY sum(o.total) DESC) as rank
    FROM users u
    JOIN orders o ON u.id = o.user_id
    GROUP BY u.username
    """, nativeQuery = true)
List<Object[]> findUserRanks(); // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ :(

```

### ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏

1. **–ú–∞–ø–ø–∏–Ω–≥ (ResultSetMapping):** –í–æ–∑–≤—Ä–∞—â–∞—Ç—å `List<Object[]>` ‚Äî —ç—Ç–æ –∞–¥. –í–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –∫–∞—Å—Ç–∏—Ç—å `(String) obj[0]`, `(BigDecimal) obj[1]`.
* *–†–µ—à–µ–Ω–∏–µ:* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Interface Projections** (Spring Data —Å–∞–º —Å–º–∞–ø–∏—Ç –∫–æ–ª–æ–Ω–∫–∏ –ø–æ –∏–º–µ–Ω–∞–º –≥–µ—Ç—Ç–µ—Ä–æ–≤) –∏–ª–∏ `@SqlResultSetMapping` (–æ—á–µ–Ω—å –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω–æ).


2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ë–î:** –ï—Å–ª–∏ –≤—ã –Ω–∞–ø–∏—à–µ—Ç–µ –∑–∞–ø—Ä–æ—Å –Ω–∞ –¥–∏–∞–ª–µ–∫—Ç–µ PostgreSQL (–∏—Å–ø–æ–ª—å–∑—É—è `jsonb_agg`), –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ –Ω–∞ H2 –∏–ª–∏ MySQL.
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤:** –ï—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ—Ç–µ –ø–æ–ª–µ –≤ Entity, —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å —Å–ª–æ–º–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Runtime (–∫–æ–≥–¥–∞ –≤—ã –µ–≥–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ).

---

## 22. Blaze-Persistence (–°–µ–∫—Ä–µ—Ç–Ω–æ–µ –æ—Ä—É–∂–∏–µ)

–≠—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç *–ø–æ–≤–µ—Ä—Ö* Hibernate. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å JPQL-–ø–æ–¥–æ–±–Ω—ã–π –∫–æ–¥, –Ω–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **–≤—Å–µ—Ö** —Ñ–∏—á —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ SQL (CTE, Window Functions, Values clause, Union).

–≠—Ç–æ –≤—ã–±–æ—Ä —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.

### –ü—Ä–∏–º–µ—Ä: CTE (–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π)

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (Electronics -> Laptops -> Gaming), –∏ –Ω–∞–º –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≤—Å—ë –ø–æ–¥–¥–µ—Ä–µ–≤–æ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º.

```java
// CriteriaBuilderFactory –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è Blaze-Persistence
CriteriaBuilder<Category> cb = cbf.create(em, Category.class)
    .withRecursive(CategoryCTE.class) // –û–±—ä—è–≤–ª—è–µ–º CTE
        .from(Category.class, "c")
        .bind("id").select("c.id")
        .bind("parent").select("c.parent")
        .where("c.id").eq(rootCategoryId) // –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞
    .unionAll() // –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —á–∞—Å—Ç—å
        .from(Category.class, "c")
        .join(CategoryCTE.class, "cte").on("cte.id").eq("c.parent.id") // Join —Å —Å–æ–±–æ–π
        .bind("id").select("c.id")
        .bind("parent").select("c.parent")
    .end()
    .select("cte")
    .from(CategoryCTE.class, "cte"); // –§–∏–Ω–∞–ª—å–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞

List<Category> tree = cb.getResultList();

```

**–ü–ª—é—Å—ã:**

* **Type Safe:** –û—à–∏–±–∫–∏ –≤–∏–¥–Ω—ã –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.
* **Entity View:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ –º–∞—Å—Å–∏–≤ –±–∞–π—Ç–æ–≤, –∞ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–ª–∏ DTO.
* **Performance:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL.

---

## 23. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ü—Ä–æ–µ–∫—Ü–∏–∏ (Projections)

–ú—ã —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª–∏, —á—Ç–æ —Ç—è–Ω—É—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ —Ü–µ–ª–∏–∫–æ–º ‚Äî –¥–æ—Ä–æ–≥–æ. Spring Data –¥–∞–µ—Ç —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è –ø—Ä–æ–µ–∫—Ü–∏–π.

### –£—Ä–æ–≤–µ–Ω—å 1: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (–ë—ã–ª–æ –≤—ã—à–µ)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç. Spring –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–∫—Å–∏ –Ω–∞ –ª–µ—Ç—É.

### –£—Ä–æ–≤–µ–Ω—å 2: Class-based (DTO) ‚Äî –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π

–í—ã –ø–∏—à–µ—Ç–µ –æ–±—ã—á–Ω—ã–π Java –∫–ª–∞—Å—Å (POJO) —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º.

```java
// DTO (Lombok @Value –¥–µ–ª–∞–µ—Ç –∫–ª–∞—Å—Å –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–º –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä)
@Value
public class UserStatDto {
    String username;
    Long orderCount;
}

// Repository
// –í–Ω–∏–º–∞–Ω–∏–µ: –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –∫–ª–∞—Å—Å—É!
@Query("SELECT new com.example.dto.UserStatDto(u.username, count(o)) " +
       "FROM User u JOIN u.orders o GROUP BY u.username")
List<UserStatDto> findUserStats();

```

* *–ü–ª—é—Å:* –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–∫—Å–∏. Hibernate —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (`new ...`). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å.
* *–ú–∏–Ω—É—Å:* –î–ª–∏–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–∞–∫–µ—Ç–æ–≤ –≤ –∑–∞–ø—Ä–æ—Å–µ (`com.example...`).

### –£—Ä–æ–≤–µ–Ω—å 3: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ü–∏–∏

–ö–æ–≥–¥–∞ –æ–¥–∏–Ω –º–µ—Ç–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–∑–æ–≤–∞.

```java
// Repository
<T> List<T> findByUsername(String username, Class<T> type);

// Service
// –•–æ—á—É –ø–æ–ª–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å
List<User> users = repo.findByUsername("alice", User.class);
// –•–æ—á—É —Ç–æ–ª—å–∫–æ –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É
List<UserSummary> summaries = repo.findByUsername("alice", UserSummary.class);
// –•–æ—á—É DTO
List<UserDto> dtos = repo.findByUsername("alice", UserDto.class);

```

### ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å (Dynamic Projections)

–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ü–∏–∏ –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å Derived Queries (–∏–∑ –∏–º–µ–Ω–∏ –º–µ—Ç–æ–¥–∞). –ù–æ –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `@Query`, –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SpEL (Spring Expression Language), —á—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –∫–æ–¥, –∏–ª–∏ –ø–∏—Å–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã.

---

## 24. Hibernate 6: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è

–ú–∞–ª–µ–Ω—å–∫–∞—è, –Ω–æ –≤–∞–∂–Ω–∞—è –¥–µ—Ç–∞–ª—å –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Spring Boot 3.

**–í Hibernate 5:**
–ï—Å–ª–∏ –≤—ã –¥–µ–ª–∞–ª–∏ `LEFT JOIN FETCH` –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (User + Orders), —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–¥–≤–∞–∏–≤–∞–ª—Å—è (User –≤–æ–∑–≤—Ä–∞—â–∞–ª—Å—è —Å—Ç–æ–ª—å–∫–æ —Ä–∞–∑, —Å–∫–æ–ª—å–∫–æ —É –Ω–µ–≥–æ –æ—Ä–¥–µ—Ä–æ–≤). –ù—É–∂–Ω–æ –±—ã–ª–æ –ø–∏—Å–∞—Ç—å `SELECT DISTINCT u ...`.
–ü—Ä–∏ —ç—Ç–æ–º `DISTINCT` —á–∞—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –≤ SQL, –∑–∞—Å—Ç–∞–≤–ª—è—è –±–∞–∑—É –¥–µ–ª–∞—Ç—å —Ç—è–∂–µ–ª—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É.

**–í Hibernate 6:**
Hibernate –¥–µ–ª–∞–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é **–≤ –ø–∞–º—è—Ç–∏** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

* –í–∞–º –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å `DISTINCT` –≤ JPQL –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–µ–π —Å—É—â–Ω–æ—Å—Ç–µ–π.
* –ï—Å–ª–∏ –≤—ã –≤—Å–µ-—Ç–∞–∫–∏ –Ω–∞–ø–∏—à–µ—Ç–µ `DISTINCT`, Hibernate 6 –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–Ω—è—Ç—å: –Ω—É–∂–µ–Ω –æ–Ω –≤ SQL –∏–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–≥–∏–∫–∏.

---

**–ö–æ–Ω–µ—Ü –£—Ä–æ–≤–Ω—è 8.**

* –ï—Å–ª–∏ –Ω—É–∂–Ω–æ ¬´–ø—Ä–æ—Å—Ç–æ –∏ –±—ã—Å—Ç—Ä–æ¬ª —á—Ç–æ-—Ç–æ —Å–ª–æ–∂–Ω–æ–µ ‚Äî –±–µ—Ä–∏—Ç–µ **Native Query** + **Interface Projection**.
* –ï—Å–ª–∏ —Å—Ç—Ä–æ–∏—Ç–µ —Å–ª–æ–∂–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É —Å–æ —Å–ª–æ—è–º–∏ ‚Äî —É—á–∏—Ç–µ **Blaze-Persistence**.
* –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **DTO –ø—Ä–æ–µ–∫—Ü–∏–∏** –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ (read-only –æ–ø–µ—Ä–∞—Ü–∏–π).

---

# –£—Ä–æ–≤–µ–Ω—å 9. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å (Hardcore): Propagation, Deadlocks –∏ Pool Starvation

## 25. Propagation (–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

–ú—ã —É–∂–µ –∑–Ω–∞–µ–º –ø—Ä–æ `@Transactional`. –ù–æ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥–æ–π? –≠—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `propagation`.

### –ö–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

1. **REQUIRED (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
* *–õ–æ–≥–∏–∫–∞:* "–ï—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è? –Ø –≤ –Ω–µ–π. –ù–µ—Ç? –°–æ–∑–¥–∞–º –Ω–æ–≤—É—é".
* *–ù—é–∞–Ω—Å:* –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ –±—Ä–æ—Å–∏—Ç `RuntimeException`, –æ–Ω –ø–æ–º–µ—Ç–∏—Ç **–≤—Å—é** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∫–∞–∫ `rollbackOnly`. –î–∞–∂–µ –µ—Å–ª–∏ –≤—ã –ø–æ–π–º–∞–µ—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤–æ –≤–Ω–µ—à–Ω–µ–º –º–µ—Ç–æ–¥–µ, –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. –ë—É–¥–µ—Ç `UnexpectedRollbackException`.


2. **REQUIRES_NEW (–ò–∑–æ–ª—è—Ü–∏—è):**
* *–õ–æ–≥–∏–∫–∞:* "–í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π –Ω–æ–≤—É—é. –ï—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ä–∞—è ‚Äî –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏ –µ—ë (Suspend)".
* *–ö–µ–π—Å:* **–ê—É–¥–∏—Ç –æ—à–∏–±–æ–∫.**
* *–ü—Ä–∏–º–µ—Ä:* –í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑. –û–ø–ª–∞—Ç–∞ —É–ø–∞–ª–∞. –í—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å "–ü–æ–ø—ã—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã –Ω–µ—É–¥–∞—á–Ω–∞" –≤ —Ç–∞–±–ª–∏—Ü—É –ª–æ–≥–æ–≤. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `REQUIRED`, —Ç–æ –æ—Ç–∫–∞—Ç –æ–ø–ª–∞—Ç—ã –æ—Ç–∫–∞—Ç–∏—Ç –∏ –ª–æ–≥. –° `REQUIRES_NEW` –ª–æ–≥ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.


3. **NESTED (–í–ª–æ–∂–µ–Ω–Ω–∞—è):**
* *–õ–æ–≥–∏–∫–∞:* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **Savepoints** (—Ç–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è) JDBC. –≠—Ç–æ –æ–¥–Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è.
* –ï—Å–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø–∞–¥–∞–µ—Ç, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫ Savepoint, –Ω–æ –≤–Ω–µ—à–Ω—è—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É.
* *–†–µ–¥–∫–æ—Å—Ç—å:* –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ JDBC, –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏.



### ‚ò†Ô∏è –ì–ª–∞–≤–Ω–∞—è –ª–æ–≤—É—à–∫–∞: Self-Invocation (–í—ã–∑–æ–≤ —Å–∞–º–æ–≥–æ —Å–µ–±—è)

–≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏.

```java
@Service
public class OrderService {

    @Transactional // (1)
    public void processOrder() {
        // –ö–∞–∫–∞—è-—Ç–æ –ª–æ–≥–∏–∫–∞...
        saveAuditLog(); // <--- –í–´–ó–û–í –í–ù–£–¢–†–ò –¢–û–ì–û –ñ–ï –ö–õ–ê–°–°–ê
    }

    @Transactional(propagation = Propagation.REQUIRES_NEW) // (2)
    public void saveAuditLog() {
        repo.save(new Log(...));
    }
}

```

**–í–æ–ø—Ä–æ—Å:** –°–æ–∑–¥–∞—Å—Ç—Å—è –ª–∏ –Ω–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è `saveAuditLog`?
**–û—Ç–≤–µ—Ç:** **–ù–ï–¢.**

**–ü–æ—á–µ–º—É?** Spring –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Proxy** (–æ–±–µ—Ä—Ç–∫—É) –≤–æ–∫—Ä—É–≥ –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Å–∞.

* –ö–æ–≥–¥–∞ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ `service.processOrder()` –∏–∑–≤–Ω–µ (–∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞), –≤—ã–∑–æ–≤ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ Proxy -> –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è -> –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥.
* –ö–æ–≥–¥–∞ –≤—ã –≤–Ω—É—Ç—Ä–∏ `processOrder` –≤—ã–∑—ã–≤–∞–µ—Ç–µ `this.saveAuditLog()`, –≤—ã –∏–¥–µ—Ç–µ **–º–∏–º–æ Proxy**, –Ω–∞–ø—Ä—è–º—É—é –∫ –º–µ—Ç–æ–¥—É. Spring –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —ç—Ç–æ—Ç –≤—ã–∑–æ–≤ –∏ –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

**–†–µ—à–µ–Ω–∏–µ:**

1. –í—ã–Ω–µ—Å—Ç–∏ `saveAuditLog` –≤ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å (`AuditService`).
2. (–ö–æ—Å—Ç—ã–ª—å) –í–Ω–µ–¥—Ä–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è (`@Autowired private OrderService self`) –∏ –≤—ã–∑—ã–≤–∞—Ç—å `self.saveAuditLog()`.

---

## 26. Deadlocks (–í–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –ë–î)

Deadlock ‚Äî —ç—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ê –∂–¥–µ—Ç —Ä–µ—Å—É—Ä—Å, –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–∂–∏—Ç –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë, –∞ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë –∂–¥–µ—Ç —Ä–µ—Å—É—Ä—Å, –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–∂–∏—Ç –ê.

### –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ü–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥

–£ –Ω–∞—Å –µ—Å—Ç—å —Å—á–µ—Ç–∞ —Å ID=1 –∏ ID=2. –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–≤–æ–¥—è—Ç –¥–µ–Ω—å–≥–∏.

* **–ü–æ—Ç–æ–∫ 1 (1 -> 2):** –ë–ª–æ–∫–∏—Ä—É–µ—Ç ID=1 ... –ø—ã—Ç–∞–µ—Ç—Å—è –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ID=2 (–∂–¥–µ—Ç).
* **–ü–æ—Ç–æ–∫ 2 (2 -> 1):** –ë–ª–æ–∫–∏—Ä—É–µ—Ç ID=2 ... –ø—ã—Ç–∞–µ—Ç—Å—è –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ID=1 (–∂–¥–µ—Ç).
* **–ò—Ç–æ–≥:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥) –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ü–∏–∫–ª –∏ —É–±–∏–≤–∞–µ—Ç –æ–¥–Ω—É –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –æ—à–∏–±–∫–æ–π `Deadlock found`.

### –†–µ—à–µ–Ω–∏–µ: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

–í—Å–µ–≥–¥–∞ –±–ª–æ–∫–∏—Ä—É–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã –≤ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ ID).

```java
@Transactional
public void transfer(Long fromId, Long toId, BigDecimal amount) {
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º ID –ø–µ—Ä–µ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π!
    Long firstLock = (fromId < toId) ? fromId : toId;
    Long secondLock = (fromId < toId) ? toId : fromId;

    // –°–Ω–∞—á–∞–ª–∞ –±–ª–æ–∫–∏—Ä—É–µ–º –º–µ–Ω—å—à–∏–π ID
    repository.findByIdAndLock(firstLock);
    // –ü–æ—Ç–æ–º –±–æ–ª—å—à–∏–π ID
    repository.findByIdAndLock(secondLock);

    // –¢–µ–ø–µ—Ä—å –±–µ–∑–æ–ø–∞—Å–Ω–æ –º–µ–Ω—è–µ–º –±–∞–ª–∞–Ω—Å—ã...
}

```

–¢–µ–ø–µ—Ä—å –æ–±–∞ –ø–æ—Ç–æ–∫–∞ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ø—ã—Ç–∞—é—Ç—Å—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ID=1. –û–¥–∏–Ω –ø—Ä–æ–π–¥–µ—Ç, –≤—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –∂–¥–∞—Ç—å. Deadlock –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.

---

## 27. Pool Starvation (–ì–æ–ª–æ–¥–∞–Ω–∏–µ –ø—É–ª–∞)

–≠—Ç–æ –æ—Å–æ–±—ã–π –≤–∏–¥ Deadlock-–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ –≤ –±–∞–∑–µ, –∞ –≤ –ø—É–ª–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (HikariCP).

**–°—Ü–µ–Ω–∞—Ä–∏–π:**

1. –£ –≤–∞—Å `maximum-pool-size = 10`.
2. –£ –≤–∞—Å –µ—Å—Ç—å –º–µ—Ç–æ–¥ –ê (`@Transactional`), –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ –ë (`@Transactional(REQUIRES_NEW)`).
3. –ü—Ä–∏—à–ª–∞ –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. 10 –ø–æ—Ç–æ–∫–æ–≤ –∑–∞—à–ª–∏ –≤ –º–µ—Ç–æ–¥ –ê. –û–Ω–∏ –∑–∞–Ω—è–ª–∏ –≤—Å–µ **10** —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏–∑ –ø—É–ª–∞.
2. –í—Å–µ 10 –ø–æ—Ç–æ–∫–æ–≤ –¥–æ—à–ª–∏ –¥–æ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ –ë.
3. –ú–µ—Ç–æ–¥ –ë —Ç—Ä–µ–±—É–µ—Ç `REQUIRES_NEW`, —Ç–æ –µ—Å—Ç—å –µ–º—É –Ω—É–∂–Ω–æ **–Ω–æ–≤–æ–µ, –æ—Ç–¥–µ–ª—å–Ω–æ–µ** —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
4. –ü–æ—Ç–æ–∫–∏ –ø—Ä–æ—Å—è—Ç —É –ø—É–ª–∞ 11-–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
5. –ü—É–ª –ø—É—Å—Ç. –ü–æ—Ç–æ–∫–∏ –∂–¥—É—Ç, –ø–æ–∫–∞ –∫—Ç–æ-—Ç–æ –≤–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
6. –ù–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–µ—Ä–∂–∞—Ç —Å–∞–º–∏ —ç—Ç–∏ –æ–∂–∏–¥–∞—é—â–∏–µ –ø–æ—Ç–æ–∫–∏ (–∏—Ö –≤–Ω–µ—à–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ê –∂–¥—É—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ë).
7. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∏—Å–∏—Ç –Ω–∞–º–µ—Ä—Ç–≤–æ** –¥–æ —Ç–∞–π–º–∞—É—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:**

1. –ò–∑–±–µ–≥–∞–π—Ç–µ `REQUIRES_NEW` –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
2. –§–æ—Ä–º—É–ª–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø—É–ª–∞ –¥–ª—è —Ç–∞–∫–∏—Ö —Å–∏—Å—Ç–µ–º:
`PoolSize = MaxThreads * (MaxNestedTransactions + 1)`
–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–º–æ–∂–Ω–∞ 1 –≤–ª–æ–∂–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –ø—É–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å –∑–∞–ø–∞—Å–æ–º.

---

# –§–∏–Ω–∞–ª: –í–∞—à –ø—É—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–∞ (Roadmap –∑–∞–≤–µ—Ä—à–µ–Ω)

–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –ú—ã –ø—Ä–æ—à–ª–∏ –ø—É—Ç—å –æ—Ç –Ω–æ–≤–∏—á–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç `SELECT *`, –¥–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–Ω–∏–º–∞–µ—Ç, –∫–∞–∫ –Ω–µ —É–±–∏—Ç—å –±–∞–∑—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏.

–í–æ—Ç —á–µ–∫-–ª–∏—Å—Ç –Ω–∞–≤—ã–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–º–∏ –≤—ã —Ç–µ–ø–µ—Ä—å –≤–ª–∞–¥–µ–µ—Ç–µ (–∏–ª–∏ –∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –∏—Å–∫–∞—Ç—å):

* ‚úÖ **JPA Core:** Entity Lifecycle, Dirty Checking, First-level cache.
* ‚úÖ **Relationships:** Owning side, Cascade, Orphan Removal.
* ‚úÖ **Spring Data:** Repository, Projections (DTO), Specifications.
* ‚úÖ **Performance:** N+1, Batching, FetchType.LAZY.
* ‚úÖ **Hardcore:** Optimistic Locking, Isolation Levels, Propagation.
* ‚úÖ **Testing:** Testcontainers.
* ‚úÖ **Architecture:** Soft Delete, Multi-tenancy, Blaze-Persistence.

---

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ? (–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ)

–¢–µ–æ—Ä–∏—è –±–µ–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏ –º–µ—Ä—Ç–≤–∞. –Ø –ø—Ä–µ–¥–ª–∞–≥–∞—é –≤–∞–º **–ß–µ–ª–ª–µ–Ω–¥–∂ –í—ã—Ö–æ–¥–Ω–æ–≥–æ –î–Ω—è**.

**–¢–ó "–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞":**

1. –°–æ–∑–¥–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ `Account` (—Å –±–∞–ª–∞–Ω—Å–æ–º) –∏ `Transfer` (–∏—Å—Ç–æ—Ä–∏—è).
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–≤–æ–¥–∞ –¥–µ–Ω–µ–≥, –∫–æ—Ç–æ—Ä—ã–π:
* –ó–∞—â–∏—â–µ–Ω –æ—Ç **Deadlock** (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ ID).
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **Optimistic Locking** (—á—Ç–æ–±—ã –Ω–∏–∫—Ç–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª –±–∞–ª–∞–Ω—Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ).
* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–≤–æ–¥–∞.


3. –ï—Å–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ—à–µ–ª, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —É–ø–∞–ª–æ ‚Äî –¥–µ–Ω—å–≥–∏ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è (–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å).
4. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç –Ω–∞ **Testcontainers**, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç 10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤, –≥–æ–Ω—è—é—â–∏—Ö –¥–µ–Ω—å–≥–∏ –º–µ–∂–¥—É –¥–≤—É–º—è —Å—á–µ—Ç–∞–º–∏. –í –∫–æ–Ω—Ü–µ —Å—É–º–º–∞ –Ω–∞ –¥–≤—É—Ö —Å—á–µ—Ç–∞—Ö –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–π (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).

---

## –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (JPA & Spring Data JPA) –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –û—Å–Ω–æ–≤–Ω—ã–µ (Identity & Setup)

–≠—Ç–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å—É—â–Ω–æ—Å—Ç—å –∏ –µ—ë —Å–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π.

#### `@Entity` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–º–µ—á–∞–µ—Ç –∫–ª–∞—Å—Å –∫–∞–∫ —Å—É—â–Ω–æ—Å—Ç—å JPA. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞.
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** –£ –∫–ª–∞—Å—Å–∞ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (`protected` –∏–ª–∏ `public`). –ë–µ–∑ –Ω–µ–≥–æ Hibernate –Ω–µ —Å–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä —á–µ—Ä–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é. –¢–∞–∫–∂–µ –∫–ª–∞—Å—Å –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `final`.

#### `@Table(name = "...")` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ó–∞–¥–∞–µ—Ç –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å, –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –±—É–¥–µ—Ç —Ä–∞–≤–Ω–æ –∏–º–µ–Ω–∏ –∫–ª–∞—Å—Å–∞ (User -> user).
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ SQL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Order`, `User`, `Group`). –ï—Å–ª–∏ –Ω–∞–∑–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ç–∞–∫ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫ (–∏–ª–∏ –±–µ–∑ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –≤ `@Table`), –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞.

#### `@Id` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –£–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞.

#### `@GeneratedValue` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –£–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ID.
* **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
* `GenerationType.IDENTITY`: –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ë–î (MySQL, Postgres).
* `GenerationType.SEQUENCE`: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Oracle, Postgres).


* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å (Expert):** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `IDENTITY` **–æ—Ç–∫–ª—é—á–∞–µ—Ç JDBC Batching** (–ø–∞–∫–µ—Ç–Ω—É—é –≤—Å—Ç–∞–≤–∫—É) –¥–ª—è `INSERT`. Hibernate –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∞—á–∫—É insert-–æ–≤, —Ç–∞–∫ –∫–∞–∫ –µ–º—É –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å ID —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –±—ã—Å—Ç—Ä–æ –∏ –º–Ω–æ–≥–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `SEQUENCE` —Å `allocationSize`.

---

### 2. –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π (Basic Mapping)

#### `@Column` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –º–∞–ø–ø–∏–Ω–≥ –Ω–∞ –∫–æ–ª–æ–Ω–∫—É (–∏–º—è, –¥–ª–∏–Ω–∞, nullability).
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** –ü–∞—Ä–∞–º–µ—Ç—Ä `nullable = false` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã (`ddl-auto`) –∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Hibernate. –ï—Å–ª–∏ –±–∞–∑–∞ —Å–æ–∑–¥–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ –∏ —Ç–∞–º –Ω–µ—Ç `NOT NULL` constraint, Hibernate –ø—Ä–æ–ø—É—Å—Ç–∏—Ç null, –µ—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è.

#### `@Enumerated` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ú–∞–ø–∏—Ç Java Enum.
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å (–ö—Ä–∏—Ç–∏—á–Ω—ã–π):** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `EnumType.ORDINAL` (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç 0, 1, 2...). –ï—Å–ª–∏ –≤—ã –¥–æ–±–∞–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–µ—Ä–µ–¥–∏–Ω—É Enum'–∞ –∏–ª–∏ –ø–æ–º–µ–Ω—è–µ—Ç–µ –∏—Ö –º–µ—Å—Ç–∞–º–∏, –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –ø–µ—Ä–µ–º–µ—à–∞—é—Ç—Å—è. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@Enumerated(EnumType.STRING)**`.

#### `@Transient` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ì–æ–≤–æ—Ä–∏—Ç Hibernate –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –ø–æ–ª–µ. –û–Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î.
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** –ù–µ –ø—É—Ç–∞—Ç—å —Å –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–æ–º Java `transient`. –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ Java –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é (Serialization), –∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è ‚Äî –Ω–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

#### `@Lob` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** Large Object. –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ (`TEXT`, `CLOB`) –∏–ª–∏ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤ (`BLOB`).
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** –í PostgreSQL `@Lob` –Ω–∞ `String` –º–æ–∂–µ—Ç –º–∞–ø–∏—Ç—å—Å—è –≤ —Ç–∏–ø `OID`, —á—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ. –ß–∞—Å—Ç–æ –ª—É—á—à–µ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@Column(columnDefinition = "TEXT")`.

---

### 3. –°–≤—è–∑–∏ (Relationships)

–°–∞–º–∞—è –æ–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞.

#### `@OneToMany` / `@ManyToOne` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–≤—è–∑—å "–û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º".
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å 1:** `FetchType`.
* –£ `@OneToMany` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `LAZY` (—Ö–æ—Ä–æ—à–æ).
* –£ `@ManyToOne` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `EAGER` (–ø–ª–æ—Ö–æ!). **–í—Å–µ–≥–¥–∞ —è–≤–Ω–æ –ø–∏—à–∏—Ç–µ `fetch = FetchType.LAZY**` –¥–ª—è `@ManyToOne`.


* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å 2:** –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏—è –≤ `toString()`, `equals()`, `hashCode()` –∏–ª–∏ –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ JSON (Jackson). –ï—Å–ª–∏ User —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ Post, –∞ Post –Ω–∞ User ‚Äî —Å—Ç–µ–∫ –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@JsonIgnore` –∏–ª–∏ DTO.

#### `@JoinColumn` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –£–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º—è –∫–æ–ª–æ–Ω–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ (Foreign Key). –°—Ç–∞–≤–∏—Ç—Å—è –Ω–∞ –í–ª–∞–¥–µ—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω–µ (—Ç–∞–º, –≥–¥–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –ª–µ–∂–∏—Ç FK).
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å, Hibernate —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä–∞—à–Ω–æ–µ –∏–º—è —á–µ—Ä–µ–∑ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ, –æ–±—ä–µ–¥–∏–Ω–∏–≤ –∏–º–µ–Ω–∞ –¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü.

#### `@ManyToMany` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–≤—è–∑—å "–ú–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º".
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (`users.remove(user)`), Hibernate –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å *–≤—Å–µ* –∑–∞–ø–∏—Å–∏ –∏–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —ç—Ç–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –≤—Å—Ç–∞–≤–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–Ω–æ–≤–æ. –≠—Ç–æ –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ. –õ—É—á—à–µ –º–∞–ø–∏—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é Entity (`@OneToMany` -> Entity -> `@ManyToOne`).

---

### 4. Hibernate Specific (Power Tools)

–≠—Ç–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ Hibernate (–Ω–µ —á–∞—Å—Ç—å JPA), –Ω–æ –æ–Ω–∏ –∫—Ä–∞–π–Ω–µ –ø–æ–ª–µ–∑–Ω—ã.

#### `@BatchSize(size = 20)` (Hibernate)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É N+1 –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π. –ì—Ä—É–∑–∏—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –ø–∞—á–∫–∞–º–∏ –ø–æ `size` —à—Ç—É–∫.
* **–ì–¥–µ —Å—Ç–∞–≤–∏—Ç—å:** –ù–∞–¥ –∫–ª–∞—Å—Å–æ–º —Å—É—â–Ω–æ—Å—Ç–∏ –∏–ª–∏ –Ω–∞–¥ –ø–æ–ª–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

#### `@Formula("sql query")` (Hibernate)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ, –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—ã–±–æ—Ä–∫–µ.
```java
@Formula("(select count(*) from posts p where p.user_id = id)")
private int postCount;

```


* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** –ó–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è (`read-only`). –ï—Å–ª–∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –µ–≥–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ Java –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç (–∏–ª–∏ –æ—à–∏–±–∫–∞).

#### `@DynamicInsert` / `@DynamicUpdate` (Hibernate)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ó–∞—Å—Ç–∞–≤–ª—è–µ—Ç Hibernate –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SQL `INSERT` / `UPDATE` —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Ö –ø–æ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å (–Ω–µ null).
* **–ü–æ–ª—å–∑–∞:** –£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä SQL –∑–∞–ø—Ä–æ—Å–∞ –∏ —Ç—Ä–∞—Ñ–∏–∫.
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** Hibernate –Ω–µ –º–æ–∂–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PreparedStatement, —Ç–∞–∫ –∫–∞–∫ SQL –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Ä–∞–∑–Ω—ã–π. –ù–µ–±–æ–ª—å—à–∞—è –ø–æ—Ç–µ—Ä—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ CPU.

#### `@Immutable` (Hibernate)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å—É—â–Ω–æ—Å—Ç—å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∞ (UPDATE) –≤ –ë–î.
* **–ü–æ–ª—å–∑–∞:** Hibernate –æ—Ç–∫–ª—é—á–∞–µ—Ç Dirty Checking –¥–ª—è —Ç–∞–∫–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É.

---

### 5. –ê—É–¥–∏—Ç –∏ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

#### `@Version` (JPA)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –í–∫–ª—é—á–∞–µ—Ç **Optimistic Locking**.
* **ü™® –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–π—Ç–µ —ç—Ç–æ –ø–æ–ª–µ –≤—Ä—É—á–Ω—É—é (`setVersion(...)`). Hibernate –¥–æ–ª–∂–µ–Ω —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º —Å–∞–º.

#### `@CreationTimestamp` / `@UpdateTimestamp` (Hibernate)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏.
* **–ê–Ω–∞–ª–æ–≥ –≤ Spring Data:** `@CreatedDate`, `@LastModifiedDate` (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `@EnableJpaAuditing` –∏ —Å–ª—É—à–∞—Ç–µ–ª—è `AuditingEntityListener`).

---

### 6. ‚ò†Ô∏è –û—Å–æ–±–∞—è –∑–æ–Ω–∞: Lombok

–•–æ—Ç—è —ç—Ç–æ –Ω–µ JPA, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ –≤–º–µ—Å—Ç–µ.

#### `@Data` (Lombok)

* **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≥–µ—Ç—Ç–µ—Ä—ã, —Å–µ—Ç—Ç–µ—Ä—ã, `equals`, `hashCode`, `toString`.
* **ü™® –ü–û–î–í–û–î–ù–´–ô –ö–ê–ú–ï–ù–¨ (–û–ü–ê–°–ù–û):**
1. `equals/hashCode` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–∞—é—Ç –≤—Å–µ –ø–æ–ª—è. –ï—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å `@OneToMany` (LAZY), –≤—ã–∑–æ–≤ `hashCode` –¥–µ—Ä–Ω–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (LazyInitException –∏–ª–∏ –ª–∏—à–Ω–∏–π –∑–∞–ø—Ä–æ—Å).
2. `toString` —Ç–æ–∂–µ –ø–æ–π–¥–µ—Ç –ø–æ –≤—Å–µ–º –ø–æ–ª—è–º -> —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞ -> StackOverflowError.
3. **–†–µ—à–µ–Ω–∏–µ:** –î–ª—è Entity –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é:
* `@Getter`
* `@Setter`
* `@ToString` (—Å `@ToString.Exclude` –Ω–∞ –ª–µ–Ω–∏–≤—ã—Ö —Å–≤—è–∑—è—Ö)
* `equals/hashCode` –ø–∏—à–∏—Ç–µ —Ä—É–∫–∞–º–∏ (—Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø–æ `@Id`, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∏–∑–Ω–µ—Å-–∫–ª—é—á).

---

## –ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Entity 

–í–æ—Ç ¬´–ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç¬ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Entity. –≠—Ç–æ—Ç –∫–æ–¥ —Ä–µ—à–∞–µ—Ç 99% –ø—Ä–æ–±–ª–µ–º, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å `LazyInitializationException`, `StackOverflowError` –∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ.

–Ø —Ä–∞–∑–¥–µ–ª–∏–ª —ç—Ç–æ –Ω–∞ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å (–¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è) –∏ —Å–∞–º—É —Å—É—â–Ω–æ—Å—Ç—å.

### 1. –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å (Auditing & MappedSuperclass)

–í—ã–Ω–æ—Å–∏–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è (–∫—Ç–æ —Å–æ–∑–¥–∞–ª, –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–∏–ª), —á—Ç–æ–±—ã –Ω–µ –º—É—Å–æ—Ä–∏—Ç—å –≤ –±–∏–∑–Ω–µ—Å-–∫–ª–∞—Å—Å–∞—Ö.

```java
@MappedSuperclass // –ü–æ–ª—è —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ –ø–æ–ø–∞–¥—É—Ç –≤ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
@EntityListeners(AuditingEntityListener.class) // –í–∫–ª—é—á–∞–µ—Ç –º–∞–≥–∏—é Spring Data Auditing
@Getter
@Setter
public abstract class BaseEntity {

    @CreationTimestamp // Hibernate —Å–∞–º –ø–æ—Å—Ç–∞–≤–∏—Ç –≤—Ä–µ–º—è –ø—Ä–∏ INSERT
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @UpdateTimestamp // Hibernate –æ–±–Ω–æ–≤–∏—Ç –≤—Ä–µ–º—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º UPDATE
    @Column(name = "updated_at")
    private LocalDateTime updatedAt;
}

```

---

### 2. –ò–¥–µ–∞–ª—å–Ω–∞—è –°—É—â–Ω–æ—Å—Ç—å (User)

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äî —Ç–∞–º –≤—Å—è —Å–æ–ª—å.

```java
import lombok.*;
import org.hibernate.annotations.BatchSize;
import org.hibernate.proxy.Hibernate;

import jakarta.persistence.*;
import java.util.*;

@Entity
@Table(name = "users")
// 1. LOMBOK: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º @Data!
@Getter
@Setter
@NoArgsConstructor // –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è Hibernate
@ToString // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π toString –Ω–∞—Å—Ç—Ä–æ–∏–º –Ω–∏–∂–µ
public class User extends BaseEntity {

    @Id
    // 2. SEQUENCE: –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Batch Insert (–≤—Å—Ç–∞–≤–∫—É –ø–∞—á–∫–∞–º–∏)
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "user_seq")
    @SequenceGenerator(name = "user_seq", sequenceName = "users_id_seq", allocationSize = 50)
    private Long id;

    @Column(nullable = false, unique = true)
    private String username;

    // 3. ENUM: –¢–æ–ª—å–∫–æ STRING!
    @Enumerated(EnumType.STRING)
    private UserStatus status = UserStatus.ACTIVE;

    // 4. –û–¢–ù–û–®–ï–ù–ò–Ø: Inverse side (–û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)
    @OneToMany(
        mappedBy = "user", // –°—Å—ã–ª–∞–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ 'user' –≤ –∫–ª–∞—Å—Å–µ Order
        cascade = CascadeType.ALL, // –°–æ—Ö—Ä–∞–Ω—è–µ–º User -> —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è Orders
        orphanRemoval = true // –£–¥–∞–ª—è–µ–º Order –∏–∑ —Å–ø–∏—Å–∫–∞ -> DELETE –∏–∑ –ë–î
    )
    // 5. FETCHING: –†–µ—à–∞–µ–º N+1 –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π
    @BatchSize(size = 20) 
    // 6. LOMBOK: –ò—Å–∫–ª—é—á–∞–µ–º –ª–µ–Ω–∏–≤—ã–µ –ø–æ–ª—è –∏–∑ toString, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç SELECT –∏–ª–∏ –æ—à–∏–±–∫–∞
    @ToString.Exclude 
    private List<Order> orders = new ArrayList<>();

    // 7. HELPER METHODS: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Å–≤—è–∑–∏
    public void addOrder(Order order) {
        orders.add(order);
        order.setUser(this); // –í–∞–∂–Ω–æ!
    }

    public void removeOrder(Order order) {
        orders.remove(order);
        order.setUser(null);
    }

    // 8. EQUALS & HASHCODE: –°–∞–º–∞—è —Å–ª–æ–∂–Ω–∞—è —á–∞—Å—Ç—å (Proxy-safe)
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        // –í–∞–∂–Ω–æ: –ø—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ Hibernate.getClass, —Ç–∞–∫ –∫–∞–∫ 'o' –º–æ–∂–µ—Ç –±—ã—Ç—å Proxy
        if (o == null || Hibernate.getClass(this) != Hibernate.getClass(o)) return false;
        User user = (User) o;
        // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ ID. –ï—Å–ª–∏ ID null (transient) -> –æ–±—ä–µ–∫—Ç—ã —Ä–∞–∑–Ω—ã–µ
        return id != null && Objects.equals(id, user.id);
    }

    @Override
    public int hashCode() {
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞! –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ö—ç—à-–∫–æ–¥–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ (–∫–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è ID).
        // –î–∞, —ç—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç HashMap –≤ Linked list –≤ —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ, –Ω–æ —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ.
        return getClass().hashCode();
    }
}

```

---

### 3. –í—Ç–æ—Ä–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (Order)

```java
@Entity
@Table(name = "orders")
@Getter
@Setter
@NoArgsConstructor
public class Order extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    private Long id;

    private String description;

    // 9. LAZY: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–µ–Ω—è–µ–º EAGER –Ω–∞ LAZY
    @ManyToOne(fetch = FetchType.LAZY) 
    @JoinColumn(name = "user_id") // –í–ª–∞–¥–µ—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (—Ç—É—Ç FK)
    @ToString.Exclude // –ò—Å–∫–ª—é—á–∞–µ–º, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ü–∏–∫–ª–∏—Ç—å toString (User -> Order -> User...)
    private User user;

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || Hibernate.getClass(this) != Hibernate.getClass(o)) return false;
        Order order = (Order) o;
        return id != null && Objects.equals(id, order.id);
    }

    @Override
    public int hashCode() {
        return getClass().hashCode();
    }
}

```

---

### –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫? (–†–∞–∑–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π)

#### –ü–æ—á–µ–º—É `hashCode` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É?

–≠—Ç–æ –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–π –º–æ–º–µ–Ω—Ç.

1. –í—ã —Å–æ–∑–¥–∞–ª–∏ `User u = new User()`. –£ –Ω–µ–≥–æ `id = null`.
2. –í—ã –ø–æ–ª–æ–∂–∏–ª–∏ –µ–≥–æ –≤ `HashSet`. –•—ç—à –ø–æ—Å—á–∏—Ç–∞–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –ø–∞–º—è—Ç–∏ –∏–ª–∏ 0).
3. –í—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ `repository.save(u)`. –ï–º—É –ø—Ä–∏—Å–≤–æ–∏–ª—Å—è `id = 100`.
4. –ï—Å–ª–∏ –±—ã `hashCode` –∑–∞–≤–∏—Å–µ–ª –æ—Ç `id`, –æ–Ω –±—ã **–∏–∑–º–µ–Ω–∏–ª—Å—è**.
5. –¢–µ–ø–µ—Ä—å `HashSet` –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –ª–µ–∂–∏—Ç –≤ "—Å—Ç–∞—Ä–æ–π" –∫–æ—Ä–∑–∏–Ω–µ (bucket), –∞ –∏—â–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π. **Memory Leak –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω.**
–í–æ–∑–≤—Ä–∞—Ç `getClass().hashCode()` —Ä–µ—à–∞–µ—Ç —ç—Ç–æ, –¥–µ–ª–∞—è —Ö—ç—à —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –≤ —Ç–µ—á–µ–Ω–∏–µ –≤—Å–µ–π –∂–∏–∑–Ω–∏ –æ–±—ä–µ–∫—Ç–∞.

#### –ü–æ—á–µ–º—É `Hibernate.getClass(this)`?

–ï—Å–ª–∏ –≤—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç–µ `User` –ª–µ–Ω–∏–≤–æ (—á–µ—Ä–µ–∑ `getReferenceById` –∏–ª–∏ –∫–∞–∫ —Å–≤—è–∑—å), Hibernate –ø–æ–¥—Å–æ–≤—ã–≤–∞–µ—Ç –≤–∞–º –Ω–µ –∫–ª–∞—Å—Å `User`, –∞ –∫–ª–∞—Å—Å `User$HibernateProxy$Zw3s...`.
–û–±—ã—á–Ω—ã–π `this.getClass()` –≤–µ—Ä–Ω–µ—Ç —Ä–∞–∑–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ –∏ –ø—Ä–æ–∫—Å–∏, –∏ `equals` –≤–µ—Ä–Ω–µ—Ç `false`, —Ö–æ—Ç—è —ç—Ç–æ –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –∑–∞–ø–∏—Å—å –≤ –ë–î.

#### –ü–æ—á–µ–º—É `@BatchSize`?

–ö–æ–≥–¥–∞ –≤—ã –±—É–¥–µ—Ç–µ –±–µ–∂–∞—Ç—å —Ü–∏–∫–ª–æ–º –ø–æ `users` –∏ –≤—ã–∑—ã–≤–∞—Ç—å `getOrders()`, –±–µ–∑ —ç—Ç–æ–π –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ Hibernate –¥–µ–ª–∞–ª –±—ã –ø–æ –æ–¥–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∞ –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞. –° –Ω–µ–π –æ–Ω –ø–æ–¥–≥—Ä—É–∑–∏—Ç –æ—Ä–¥–µ—Ä–∞ —Å—Ä–∞–∑—É –¥–ª—è 20 (–∏–ª–∏ 50) —é–∑–µ—Ä–æ–≤ –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑. –≠—Ç–æ –¥–µ—à–µ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ N+1 –±–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

#### –ü–æ—á–µ–º—É `allocationSize = 50`?

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ 50, –Ω–æ –∏–Ω–æ–≥–¥–∞ –ª—é–¥–∏ —Å—Ç–∞–≤—è—Ç 1.
–ï—Å–ª–∏ `allocationSize = 1`, Hibernate –±—É–¥–µ—Ç —Ö–æ–¥–∏—Ç—å –≤ –±–∞–∑—É –∑–∞ –Ω–æ–≤—ã–º ID **–∫–∞–∂–¥—ã–π —Ä–∞–∑** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞.
–ï—Å–ª–∏ `allocationSize = 50`, –æ–Ω –æ–¥–∏–Ω —Ä–∞–∑ —Å—Ö–æ–¥–∏—Ç –≤ –±–∞–∑—É, –ø–æ–ª—É—á–∏—Ç –¥–∏–∞–ø–∞–∑–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000-1050) –∏ —Å–ª–µ–¥—É—é—â–∏–µ 50 –æ–±—ä–µ–∫—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤ –ø–∞–º—è—Ç–∏ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ, –∞ –ø–æ—Ç–æ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç –∏—Ö –≤ –ë–î –æ–¥–Ω–∏–º –ø–∞–∫–µ—Ç–æ–º (Batch).

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π —Å –ø–æ–º–æ—â—å—é TestContainers

–í–æ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Ç–µ—Å—Ç–∞ –¥–ª—è –Ω–∞—à–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π `User` –∏ `Order`.

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (pom.xml)

–í–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è —ç—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–≤–µ—Ä—Å–∏–∏ Spring Boot –ø–æ–¥—Ç—è–Ω–µ—Ç —Å–∞–º, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `spring-boot-starter-parent`):

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.testcontainers</groupId>
        <artifactId>postgresql</artifactId>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.testcontainers</groupId>
        <artifactId>junit-jupiter</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>

```

---

### 2. –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ß—Ç–æ–±—ã –Ω–µ –ø–æ–¥–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç-–∫–ª–∞—Å—Å–∞ –∑–∞–Ω–æ–≤–æ (—ç—Ç–æ –¥–æ–ª–≥–æ), –º—ã —Å–æ–∑–¥–∞–¥–∏–º –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤.

```java
import org.springframework.test.context.DynamicPropertyRegistry;
import org.springframework.test.context.DynamicPropertySource;
import org.testcontainers.containers.PostgreSQLContainer;
import org.testcontainers.junit.jupiter.Testcontainers;

@Testcontainers
public abstract class AbstractIntegrationTest {

    // –ü–æ–¥–Ω–∏–º–∞–µ–º Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å Postgres 15
    private static final PostgreSQLContainer<?> POSTGRES = 
        new PostgreSQLContainer<>("postgres:15-alpine")
            .withReuse(true); // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

    static {
        POSTGRES.start();
    }

    // –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ application.properties –Ω–∞ –ª–µ—Ç—É, 
    // —á—Ç–æ–±—ã Spring –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ —ç—Ç–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", POSTGRES::getJdbcUrl);
        registry.add("spring.datasource.username", POSTGRES::getUsername);
        registry.add("spring.datasource.password", POSTGRES::getPassword);
        
        // –í–∞–∂–Ω–æ: –æ—Ç–∫–ª—é—á–∞–µ–º ddl-auto=update, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å flyway/liquibase. 
        // –ù–æ –¥–ª—è —Ç–µ—Å—Ç–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–æ–ø—É—Å—Ç–∏–º–æ create-drop
        registry.add("spring.jpa.hibernate.ddl-auto", () -> "create-drop");
    }
}

```

---

### 3. –°–∞–º —Ç–µ—Å—Ç (UserRepositoryTest)

–ó–¥–µ—Å—å –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å—ë: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∫–∞—Å–∫–∞–¥—ã, –≥–µ–Ω–µ—Ä–∞—Ü–∏—é ID, –∞—É–¥–∏—Ç –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–∏—Ä–æ—Ç.

```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.boot.test.autoconfigure.orm.jpa.TestEntityManager;
import org.springframework.context.annotation.Import;

import java.util.Optional;
import static org.assertj.core.api.Assertions.assertThat;

@DataJpaTest // –ü–æ–¥–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ JPA –∫–æ–Ω—Ç–µ–∫—Å—Ç (–±—ã—Å—Ç—Ä–æ)
// –û—Ç–∫–ª—é—á–∞–µ–º –ø–æ–ø—ã—Ç–∫—É Spring –∑–∞–º–µ–Ω–∏—Ç—å –±–∞–∑—É –Ω–∞ H2. –ú—ã —Ö–æ—Ç–∏–º –Ω–∞—à Docker!
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
class UserRepositoryTest extends AbstractIntegrationTest {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private TestEntityManager entityManager; // –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –Ω–∞–ø—Ä—è–º—É—é

    @Test
    void shouldGenerateIdAndAuditFields() {
        // Given
        User user = new User();
        user.setUsername("test_user");

        // When
        User savedUser = userRepository.save(user);
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫—ç—à (flush & clear), —á—Ç–æ–±—ã –∑–∞—Å—Ç–∞–≤–∏—Ç—å Hibernate —Å—Ö–æ–¥–∏—Ç—å –≤ –ë–î 
        // –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —á—Ç–µ–Ω–∏–∏. –ò–Ω–∞—á–µ –º—ã –ø—Ä–æ–≤–µ—Ä–∏–º —Ç–æ–ª—å–∫–æ –∫—ç—à.
        entityManager.flush();
        entityManager.clear();

        // Then
        User foundUser = userRepository.findById(savedUser.getId()).orElseThrow();
        
        assertThat(foundUser.getId()).isNotNull(); // ID —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω (Sequence)
        assertThat(foundUser.getCreatedAt()).isNotNull(); // @CreationTimestamp —Å—Ä–∞–±–æ—Ç–∞–ª
        assertThat(foundUser.getStatus()).isEqualTo(UserStatus.ACTIVE); // Default value
    }

    @Test
    void shouldPersistOrdersCascade() {
        // Given
        User user = new User();
        user.setUsername("buyer");

        Order order1 = new Order();
        order1.setDescription("Laptop");
        
        Order order2 = new Order();
        order2.setDescription("Mouse");

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à helper-–º–µ—Ç–æ–¥!
        user.addOrder(order1);
        user.addOrder(order2);

        // When
        userRepository.save(user); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¢–û–õ–¨–ö–û —é–∑–µ—Ä–∞
        
        entityManager.flush();
        entityManager.clear();

        // Then
        User foundUser = userRepository.findById(user.getId()).get();
        
        assertThat(foundUser.getOrders()).hasSize(2);
        assertThat(foundUser.getOrders().get(0).getUser()).isNotNull(); // –°–≤—è–∑—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
    }

    @Test
    void shouldRemoveOrphan() {
        // 1. –°–æ–∑–¥–∞–µ–º —é–∑–µ—Ä–∞ —Å –æ—Ä–¥–µ—Ä–æ–º
        User user = new User();
        user.setUsername("deleter");
        Order order = new Order();
        order.setDescription("To delete");
        user.addOrder(order);
        
        user = userRepository.save(user);
        entityManager.flush();
        entityManager.clear();

        // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º –æ—Ä–¥–µ—Ä –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        User loadedUser = userRepository.findById(user.getId()).get();
        Order loadedOrder = loadedUser.getOrders().get(0);
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º helper –¥–ª—è —Ä–∞–∑—Ä—ã–≤–∞ —Å–≤—è–∑–∏
        loadedUser.removeOrder(loadedOrder);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è (User)
        userRepository.save(loadedUser);
        entityManager.flush();
        entityManager.clear();

        // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ä–¥–µ—Ä –∏—Å—á–µ–∑ –∏–∑ –ë–î
        Order deletedOrder = entityManager.find(Order.class, loadedOrder.getId());
        assertThat(deletedOrder).isNull(); // orphanRemoval = true —Å—Ä–∞–±–æ—Ç–∞–ª!
    }
}

```

### –ù–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –≤ —ç—Ç–æ–º –∫–æ–¥–µ:

1. `entityManager.flush()` –∏ `clear()`: –≠—Ç–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ** –≤ —Ç–µ—Å—Ç–∞—Ö `@DataJpaTest`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª–∏—Ç—Å—è –≤–µ—Å—å —Ç–µ—Å—Ç. –ï—Å–ª–∏ –≤—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –æ–±—ä–µ–∫—Ç –∏ —Ç—É—Ç –∂–µ –ø–æ–ø—ã—Ç–∞–µ—Ç–µ—Å—å –µ–≥–æ –Ω–∞–π—Ç–∏ (`findById`), Hibernate –≤–µ—Ä–Ω–µ—Ç –≤–∞–º –æ–±—ä–µ–∫—Ç **–∏–∑ –ø–∞–º—è—Ç–∏** (L1 Cache), –¥–∞–∂–µ –Ω–µ –¥–µ–ª–∞—è –∑–∞–ø—Ä–æ—Å –≤ –ë–î. –í—ã–∑–æ–≤—ã `flush` (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î) –∏ `clear` (–æ—á–∏—Å—Ç–∏—Ç—å –ø–∞–º—è—Ç—å) –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å —Ä–µ–∞–ª—å–Ω–æ –ø–æ–π–¥–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Postgre –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç, –∫–∞–∫ –≤—Å—ë —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ.
2. `@AutoConfigureTestDatabase(replace = NONE)`: –ë–µ–∑ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ Spring –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Testcontainers –∏ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å H2.
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Ä–æ—Ç (Orphan Removal):** –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∏–∑ Java-—Å–ø–∏—Å–∫–∞ `orders` —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ `DELETE FROM orders` –≤ –±–∞–∑–µ.